function validation(){var n=$.Deferred(),u=$("#firstName"),f=$("#question"),t=$("#clientEmail"),i="",r;if($("input[type=radio]:checked").each(function(){i=this.value}),$.each([u[0],t[0],f[0]],function(){if(this.value)isValid=!0;else{$(this).css("border-color","red");isValid=!1;n.reject();return}}),isValid==!0)if(i)if(i=="4")if($("#agtName").val()!="")if(r=$("#agtName").val(),isValidEmailAddress(r)==!0)echk=r,n.resolve();else{$("#agtName").css("border-color","red");$('<span class="errMsg">Please type a valid email address.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails");isValid=!1;n.reject();return}else{$('<span class="errMsg">Please type the agent email.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails");isValid=!1;n.reject();return}else isValidEmailAddress(t.val())==!0?(isValid=!0,n.resolve(),$("#agtstatus").val("1")):(t.css("border-color","red"),$('<span class="errMsg">Please type a valid email address.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails"),isValid=!1,n.reject());else $('<span class="errMsg">Please select option.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails"),isValid=!1,n.reject();return n.promise(isValid)}function agtInfo(){var t=$.Deferred(),n=new Date,i=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=["January","February","March","April","May","June","July","August","September","October","November","December"],u;return echk!=""?(u=$.searchAgent(echk),u.done(function(u){var f=JSON.parse(u.d),e,o;if(f!=null){$(".dvAgentDetails").is(":visible")?$("#agtEmail").text()!=f.AgentEmail&&(e='<img src="https://pictures.tripmasters.com/siteassets/m/'+f.AgentID+'.jpg" alt="'+f.FirstName+" "+f.LastName+'" title="'+f.FirstName+" "+f.LastName+'" />',$(".dvAgentDetails div:nth-child(1)").html(""),$(".dvAgentDetails div:nth-child(1)").html(e),$("#agtNa").text(""),$("#agtEmail").text(""),$("#day").html(""),$("#agtNa").text(f.FirstName+" "+f.LastName),$("#agtEmail").text(f.AgentEmail),username=f.AgentEmail,$("#day").html("Today: <b>"+i[n.getDay()]+" "+r[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear()+"<\/b>"),wkSchedule(u)):(e='<img src="https://pictures.tripmasters.com/siteassets/m/'+f.AgentID+'.jpg" alt="'+f.FirstName+" "+f.LastName+'" title="'+f.FirstName+" "+f.LastName+'" />',$(".dvAgentDetails div:nth-child(1)").html(e),$("#agtNa").text(f.FirstName+" "+f.LastName),$("#agtEmail").text(f.AgentEmail),username=f.AgentEmail,$("#day").html("Today: <b>"+i[n.getDay()]+" "+r[n.getMonth()]+" "+n.getDate()+", "+n.getFullYear()+"<\/b>"),wkSchedule(u));o=f.AgentStatus;switch(o){case"Available":f.CoontactType==null||f.CoontactType==contactType?f.ActiveChats<activeChats?($("#status").text("Available"),$("#status").removeClass("offline"),$("#status").addClass("available"),$("#agtstatus").val("1"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".errMsg").is(":visible")&&$(".errMsg").remove(),chkSts==1&&(clearInterval(interval),$(".submit").trigger("click"),chkSts=0),isValid=!0,t.resolve()):($("#status").text("Not available"),$("#status").removeClass("available"),$("#status").addClass("offline"),$("#agtName").val(""),$(".dvAgtNa").hide(),$("input[type=radio][name=rdBtn]").prop("checked",""),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgentDetails"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").show(),isValid=!1,t.reject()):($("#status").text("Not available"),$("#status").removeClass("available"),$("#status").addClass("offline"),$("#agtName").val(""),$(".dvAgtNa").hide(),$("input[type=radio][name=rdBtn]").prop("checked",""),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgentDetails"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").show(),isValid=!1);break;case"Busy":$("#status").text("Not available (on a call)");$("#status").removeClass("available");$("#status").addClass("offline");$("#agtName").val("");$(".dvAgtNa").hide();$("input[type=radio][name=rdBtn]").prop("checked","");isValid=!1;$(".dvFormDetails").hide();$(".dvChatHeader span:nth-child(3)").hide();$(".dvChatHeader span:nth-child(4)").hide();$(".dvAgentDetails").show();break;default:$(".dvAgentDetails").is(":visible")||($(".dvFormDetails").slideUp("fast"),$(".dvAgtNa").slideUp(),$("input[type=radio][name=rdBtn]").prop("checked",""),$("#status").switchClass("available","offline").text("Not available"),$("#agtName").val(""),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgentDetails"),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").hide().slideDown("slow"));isValid=!1;t.reject()}}else isValid=!1,$(".dvAgentDetails").slideUp("slow"),$(".dvFormDetails").slideUp("fast"),$("input[type=radio][name=rdBtn]").prop("checked",""),clearInterval(interval),echk="",$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgentDetails"),t.reject()})):t.resolve(),t.promise()}function wkSchedule(n){var r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=new Date,e=JSON.parse(n.d),t="",i="",u=r[f.getDay()];$(".dvSchedule").html("");$.each(r,function(n,r){$.each(e,function(n,f){var o,e;r.toLowerCase()==n.replace("In","")&&(e=new Date(f),t=formatAMPM(e));r.toLowerCase()==n.replace("Out","")&&(e=new Date(f),i=formatAMPM(e),f!=null?o="<div class='dvDaySchedule'><span class='spDay'> "+r+" <\/span><span class='spDayHours'> "+t+" - "+i+" ET<\/span><\/div>":(t="Day Off",o="<div class='dvDaySchedule'><span class='spDay'> "+r+" <\/span><span class='spDayHours'> "+t+"<\/span><\/div>"),$(".dvSchedule").append(o));u.toLowerCase()==n.replace("In","")&&(e=new Date(f),t=formatAMPM(e));u.toLowerCase()==n.replace("Out","")&&(e=new Date(f),t=formatAMPM(e),$("#work").html("Working: <b>"+t+" - "+i+" ET<\/b>"))})})}function formatAMPM(n){var t=n.getHours(),i=n.getMinutes(),r=t>=12?"PM":"AM";return t=t%12,t=t?t:12,i=i<10?"0"+i:i,t+":"+i+" "+r}function successHandler(n){window.chatSession=n;$("#divSpinner").fadeOut(200);$("#chatWrapper").fadeIn(400);n.incomingItemDecorator=function(t){var i,r,u;return["SYSTEM_MESSAGE"].indexOf(t.displayName)!==-1&&(t.displayName="System Message"),n.transcript.length>0&&(i=n.transcript[n.transcript.length-1],i.transportDetails.direction==="Incoming"&&(r="Welcome to TripMasters",u=i.displayName,["prod","$LATEST","AI Assistant","SYSTEM_MESSAGE","System Message"].indexOf(u)===-1&&(r="You are now chatting with "+u),document.getElementById("chatDescription").innerHTML=r)),t};n.onIncoming(function(n){chatStart==undefined&&n.ParticipantRole=="AGENT"&&(chatStart=new Date)});n.onOutgoing(function(){chatEnd=new Date});n.onChatDisconnected(function(){resetForm();var n=chatEnd-chatStart,t=n/1e3;elapsedTime=Math.round(Math.abs(t));elapsedTime>60?$(".section-survey").show("slide").delay(4500):$("#section-main").show("slide")});connect.ChatInterface.init({containerId:"root",headerConfig:{isHTML:!0,render:()=>`
                            <div class="header-wrapper">
                                <img class="welcome-image" src="https://pictures.tripmasters.com/siteassets/d/ChatIcon.png" />
                                <span id="chatDescription">Welcome to TripMasters</span>
                            </div>
                        `}})}function failureHandler(n){console.log("failed",n)}function resetForm(){document.getElementById("startChat").disabled=!1;document.getElementById("firstName").disabled=!1;document.getElementById("clientEmail").disabled=!1;document.getElementById("question").disabled=!1;$("#section-chat").removeAttr("style");$("#nav").css("width","690");$("#section-chat").hide("slide");document.getElementById("chatDetails").reset();$("#agtstatus").val("0");$(".dvFormDetails").show("slow");$(".dvChatHeader span:nth-child(3)").show();$(".dvChatHeader span:nth-child(4)").show();$(".dvAgentDetails").hide("slow");$(".dvAgtNa").hide();$(".errMsg").text("");$(".errMsg").remove()}function resetSurvey(){document.getElementById("formsurvey").reset();document.getElementById("yes").checked=!1;document.getElementById("no").checked=!0;$("input[name=politeness]").attr("checked",!1);$("input[name=proficiency]").attr("checked",!1)}function isValidEmailAddress(n){var t=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return t.test(n)}var chatStart,chatEnd,elapsedTime;$(document).ready(()=>{connect.ChatInterface.init({containerId:"root",headerConfig:{isHTML:!0,render:()=>`
                                <div class="header-wrapper">
                                    <h2 class="welcome-text">Chat Demo</h2>
                                    <p id="chatDescription">You can modify this header or use the default.</p>
                                </div>
                            `}})});var isValid=!1,interval,echk,username="",chkSts=0,ContactId="";$(function(){$(".submit").click(function(n){n.preventDefault();clearInterval(interval);echk="";$("input[type=radio]:checked").each(function(){username=this.value});var t=new $.Deferred;$.when(validation(),agtInfo()).done(function(n){var t=$("#firstName").val(),i=$("#question").val(),r=document.referrer,u=navigator.userAgent,f=$("#clientEmail").val(),o=$("#agtstatus").val();username=="4"&&(username=$("#agtEmail").text());let e=JSON.stringify({username:username,customerName:t,question:i,refpage:r,useragentbrowser:u,clientemail:f});n!==!1&&(document.getElementById("chatDetails").reset(),$("#firstName").blur(),$("#username").blur(),document.getElementById("startChat").disabled=!0,document.getElementById("firstName").disabled=!0,$("#nav").css("width","1063"),$("#chatWrapper").hide(),$("#section-main").hide(),$("#section-chat").show("slide"),$("#section-chat").draggable({handle:".header-wrapper"}),$("#divSpinner").fadeIn(),connect.ChatInterface.initiateChat({name:t,username:username,region:"us-west-2",apiGatewayEndpoint:"https://jxdaz82s3k.execute-api.us-west-2.amazonaws.com/live/awsconnect/startchat",contactAttributes:e,contactFlowId:"caeb91a4-17e6-4d69-b050-c3f0f105eccc",instanceId:"29aef2c1-06fb-4c89-bb68-61faa40808f8"},successHandler,failureHandler))}).fail(function(){interval=setInterval(function(){agtInfo()},1e4);chkSts=1;return})});$("input[type=radio][name=rdBtn]").change(function(){this.value==="4"?($(".errMsg").is(":visible")?$(".errMsg").hide():$(".errMsg").show(),$(".dvAgtNa").show()):($(".errMsg").remove(),$(".errMsg").is(":visible")?$(".errMsg").hide():$(".errMsg").show(),$(".dvAgtNa").hide(),$("#agtstatus").val("1"),$("#agtName").val(""))});$("#spExpand").click(function(){$(".dvSchedule").is(":visible")==!0?($("#spExpand").removeClass("collapsed"),$(".dvSchedule").hide("slow")):($("#spExpand").addClass("collapsed"),$(".dvSchedule").show("slow"))});$("#firstName").click(function(){$(this).removeAttr("style")});$("#clientEmail").click(function(){$(this).removeAttr("style")});$("#question").click(function(){$(this).removeAttr("style")});$("#agtName").focus(function(){$(".errMsg").remove();$(this).removeAttr("style")});$(":checkbox").change(function(){this.value=="true"?($(this).prop("checked",!0),$("#no").prop("checked",!1)):($(this).prop("checked",!0),$("#yes").prop("checked",!1))});$("#submitSurvey").click(function(n){n.preventDefault();var i="null",r="null",u="",f=$("#formSurvey").serialize(),t=$("#formsurvey").serializeObject();"politeness"in t?i=t.politeness:"";"proficiency"in t?r=t.proficiency:"";"comments"in t?u=t.comments:"";ContactId!=""&&$.ajax({type:"POST",url:"/WS_Library.asmx/PostSurvey",contentType:"application/json; charset=utf-8",dataType:"json",data:"{transcript:"+t.transcript+', politeness:"'+i+'", proficiency:"'+r+'", comments:"'+u+'", contactId:"'+ContactId+'"}',success:function(){$("#section-main").show("slide");$(".section-survey").hide("slide");ContactId="";resetSurvey()},error:function(n){alert(n.responseText+" = error")}})})});$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};$.searchAgent=function(n){return $.ajax({type:"POST",url:"/WS_Library.asmx/GetChtInfo",contentType:"application/json; charset=utf-8",dataType:"json",data:'{email:"'+n+'"}'}).promise()};