function IframeRef(n){return n.contentWindow?n.contentWindow.document:n.contentDocument}function getIframe(){var t,n,r;const i=document.getElementsByClassName("show");t=1;i.length>=1&&(t=i[1]);n=IframeRef(t);r=setInterval(function(){var t=n.querySelectorAll("[data-testid=amazon-connect-chat-wrapper]"),i;t.length>0&&(clearInterval(r),i=setInterval(function(){if(ContactId=t[0].getAttribute("data-contactid"),ContactId!=""){clearInterval(i);var r=setInterval(function(){var t=n.querySelectorAll("[data-testid=end-chat-button]"),i;t.length>0&&(clearInterval(r),t[0].addEventListener("click",clickEndChat,!1),i=setInterval(function(){var t=n.querySelectorAll("[data-testid=close-chat-button]");t.length>0&&(clearInterval(i),t[0].addEventListener("click",clickEndChat,!1))},1e3))},1e3)}},1e3))},1e3)}function clickEndChat(){LoadSurvey();setTimeout(function(){document.getElementById("amazon-connect-chat-widget").style.display="none";const n=document.getElementsByClassName("acOpenButton-0-0-46");n.length>0&&(n[0].style.display="none");const t=document.getElementsByClassName("acCloseButton-0-0-46");t.length>0&&(t[0].style.display="none")},3e3)}function wkSchedule(n){var r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],f=new Date,e=n,t="",i="",u=r[f.getDay()];$(".dvSchedule").html("");$.each(r,function(n,r){$.each(e[0],function(n,f){var o,e;r.toLowerCase()==n.replace("In","")&&(e=new Date(f),t=formatAMPM(e));r.toLowerCase()==n.replace("Out","")&&(e=new Date(f),i=formatAMPM(e),f!=null?o="<div class='dvDaySchedule'><span class='spDay'> "+r+" <\/span><span class='spDayHours'> "+t+" - "+i+" ET<\/span><\/div>":(t="Day Off",o="<div class='dvDaySchedule'><span class='spDay'> "+r+" <\/span><span class='spDayHours'> "+t+"<\/span><\/div>"),$(".dvSchedule").append(o));u.toLocaleLowerCase()==n.replace("In","")&&(e=new Date(f),t=formatAMPM(e));u.toLocaleLowerCase()==n.replace("Out","")&&(e=new Date(f),t=formatAMPM(e),$("#work").html("Working: <b>"+t+" - "+i+" ET<\/b>"))})})}function formatAMPM(n){var t=n.getHours(),i=n.getMinutes(),r=t>=12?"PM":"AM";return t=t%12,t=t?t:12,i=i<10?"0"+i:i,t+":"+i+" "+r}function LoadSurvey(){resetForm();agentMsgToSurvey>0?$(".section-survey").show("slide").delay(4500):$("#section-main").show("slide")}function resetForm(){document.getElementById("startChat").disabled=!1;document.getElementById("firstName").disabled=!1;document.getElementById("clientEmail").disabled=!1;document.getElementById("question").disabled=!1;$("#section-chat").removeAttr("style");$("#nav").css("width","690");$("#section-chat").hide("slide");document.getElementById("chatDetails").reset();$("#agtstatus").val("0");$(".dvFormDetails").show();$(".dvChatHeader span:nth-child(3)").show();$(".dvChatHeader span:nth-child(4)").show();$(".dvAgentDetails").hide();$(".dvAgtNa").hide();$(".errMsg").text("");$(".errMsg").remove();$(".dvSchedule").html("")}function resetSurvey(){document.getElementById("formsurvey").reset();document.getElementById("transyes").checked=!1;document.getElementById("transno").checked=!0;document.getElementById("resno").checked=!1;document.getElementById("resyes").checked=!1;document.getElementById("timeyes").checked=!1;document.getElementById("timeno").checked=!1;$("input[name=politeness]").attr("checked",!1);$("input[name=proficiency]").attr("checked",!1);$("input[name=rating]").attr("checked",!1)}function isValidEmailAddress(n){var t=new RegExp(/^(("[\w-+\s]+")|([\w-+]+(?:\.[\w-+]+)*)|("[\w-+\s]+")([\w-+]+(?:\.[\w-+]+)*))(@((?:[\w-+]+\.)*\w[\w-+]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][\d]\.|1[\d]{2}\.|[\d]{1,2}\.))((25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\.){2}(25[0-5]|2[0-4][\d]|1[\d]{2}|[\d]{1,2})\]?$)/i);return t.test(n)}function blinkChatTabOff(){sound.pause();clearInterval(timeoutId);timeoutId=null;document.title=oldTitle;document.getElementById("ctl00_tmFavicon").href=oldIcon;document.removeEventListener("click",blinkChatTabOff)}var isValid=!1,interval,echk,username="",chkSts=0,ContactId="",agentMsgToSurvey=0,customerName="",question="",refpage="",useragentbrowser="",clientemail="",status="",chatStart,chatEnd,elapsedTime;$(function(){function n(){var n,t;customerName=$("#firstName").val();question=$("#question").val();refpage=document.referrer;useragentbrowser=navigator.userAgent;clientemail=$("#clientEmail").val();status=$("#agtstatus").val();username=="99"&&(username=$("#agtEmail").text());document.getElementById("chatDetails").reset();$("#firstName").blur();$("#username").blur();document.getElementById("startChat").disabled=!0;document.getElementById("firstName").disabled=!0;$("#nav").css("width","1063");$("#chatWrapper").hide();$("#section-main").hide();$("#section-chat").show("slide");$("#section-chat").draggable({handle:".header-wrapper"});$("#divSpinner").fadeIn(),function(n,t,i,r){s=t.createElement("script");s.src="https://dg9yx063wiiht.cloudfront.net/amazon-connect-chat-interface-client.js";s.async=1;s.id=r;t.getElementsByTagName("head")[0].appendChild(s);n[i]=n[i]||function(){(n[i].ac=n[i].ac||[]).push(arguments)}}(window,document,"amazon_connect","103b353d-e55b-44f4-84c2-5550be60fd63");amazon_connect("styles",{openChat:{color:"white",backgroundColor:"#123456"},closeChat:{color:"white",backgroundColor:"#123456"}});amazon_connect("snippetId","QVFJREFIaW80NEppRGNKMjg1T0xNN2M5djJLZkVBUmFXNVlJeW5VM3RXSDRmMU9zb0FHSUFUL3hHb3FoQzJyZUl3a2l4RU1xQUFBQWJqQnNCZ2txaGtpRzl3MEJCd2FnWHpCZEFnRUFNRmdHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNT2M3L3lxMkR2ZlpPM0hHZ0FnRVFnQ3RWeEhuM3IrRDE1RitocnE1bU9NZy95cEViQUV1SXJjanMrK0M3WTN3YnFEL0RFb3lGdGlqUzRjOHI6OlpxWFFMczdROE8zaURTOUxtWEdBZThxeGZaaXQ5dXBiS0ZZRlZ3K2dsVktIY0RNa2hqZnY2WVRLcDB4cGRvbUpYT0NmdlhTcGJoTWNiZWVBZm9oaGdJbEVkWGI0SFJqdExzTG1BaE1kY2pjVS8zaHkrWVc2ZU52TkJ6OFM4T0xNdzUzc1VQRnFNV05yRWRaeUU2bjlZSE9rUCs0dHdKYz0=");n=/(android)/i.test(navigator.userAgent);n||amazon_connect("supportedMessagingContentTypes",["text/plain","text/markdown"]);amazon_connect("customerDisplayName",function(n){const t=customerName;n(t)});amazon_connect("authenticate",function(n){function r(){console.log("Listener: "+this.responseText)}$("#divSpinner").fadeOut(200);let i={username:username,customerName:customerName,question:question,refpage:refpage,useragentbrowser:useragentbrowser,clientemail:clientemail};var t=new XMLHttpRequest;t.overrideMimeType("application/json");t.addEventListener("load",r);t.open("POST"," https://jxdaz82s3k.execute-api.us-west-2.amazonaws.com/live/awsconnect/widgetchat",!0);t.setRequestHeader("Content-Type","application/json; charset=utf-8");t.onreadystatechange=function(){if(t.readyState==4&&t.status=="200"){let i=JSON.parse(t.responseText);agentMsgToSurvey++;n(i.data)}};t.send(JSON.stringify(i))});setTimeout(function(){const n=document.querySelectorAll('[class^="acOpenButton-0-0-1"]');n.length>0&&n[0].click()},3e3);t=setInterval(function(){const n=document.getElementsByClassName("show");n.length==2&&n[1].nodeName!="DIV"&&(clearInterval(t),getIframe())},1e3)}$("#startChat").click(function(t){var r,u;if(t.preventDefault(),clearInterval(interval),echk="",isValid=!0,customerName=$("#firstName"),question=$("#question"),clientemail=$("#clientEmail"),username="",$("input[type=radio]:checked").each(function(){username=this.value}),$.each([customerName[0],clientemail[0],question[0]],function(){this.value?isValid=!0:($(this).css("border-color","red"),isValid=!1)}),isValid==!0&&(username?(isValidEmailAddress(clientemail.val())==!0?(isValid=!0,$("#agtstatus").val("1")):(clientemail.css("border-color","red"),$('<span class="errMsg">Please type a valid email address.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails"),isValid=!1),username=="99"&&($("#agtName").val()!=""?(r=$("#agtName").val(),isValidEmailAddress(r)==!0?echk=r:($("#agtName").css("border-color","red"),$('<span class="errMsg">Please type a valid agent email address.<\/span><br style="clear:both">').insertAfter(".dvAgtNa"),isValid=!1)):($('<span class="errMsg">Please type the agent email.<\/span><br style="clear:both">').insertAfter(".dvAgtNa"),isValid=!1))):($('<span class="errMsg">Please select option.<\/span><br style="clear:both">').insertAfter(".dvAgentDetails"),isValid=!1)),u=!1,isValid==!0){var i=new Date,f=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],e=["January","February","March","April","May","June","July","August","September","October","November","December"];echk!=""&&(u=!0,username=$("#agtEmail").text(),$.ajax({type:"POST",url:"/Api/GetChtInfo",contentType:"application/json; charset=utf-8",data:JSON.stringify(echk),success:function(t){var r=t[0],u,o;if(r!=null){$(".dvAgentDetails").is(":visible")?$("#agtEmail").text()!=r.agentEmail&&(u='<img src="https://pictures.tripmasters.com/intranet/'+r.agentId+'.jpg" alt="'+r.firstName+" "+r.lastName+'" title="'+r.firstName+" "+r.lastName+'" />',$(".dvAgentDetails div:nth-child(1)").html(""),$(".dvAgentDetails div:nth-child(1)").html(u),$("#agtNa").text(""),$("#agtEmail").text(""),$("#day").html(""),$("#agtNa").text(r.firstName+" "+r.lastName),$("#agtEmail").text(r.agentEmail),username=r.agentEmail,$("#day").html("Today: <b>"+f[i.getDay()]+" "+e[i.getMonth()]+" "+i.getDate()+", "+i.getFullYear()+"<\/b>"),wkSchedule(t)):(u='<img src="https://pictures.tripmasters.com/intranet/'+r.agentId+'.jpg" alt="'+r.firstName+" "+r.lastName+'" title="'+r.firstName+" "+r.lastName+'" />',$(".dvAgentDetails div:nth-child(1)").html(u),$("#agtNa").text(r.firstName+" "+r.lastName),$("#agtEmail").text(r.agentEmail),username=r.agentEmail,$("#day").html("Today: <b>"+f[i.getDay()]+" "+e[i.getMonth()]+" "+i.getDate()+", "+i.getFullYear()+"<\/b>"),wkSchedule(t));o=r.agentStatus;switch(o){case"Available":r.contactType==null||r.contactType==contactType?r.activeChats<activeChats?($("#status").text("Available"),$("#status").removeClass("offline"),$("#status").addClass("available"),$("#agtstatus").val("1"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".errMsg").is(":visible")&&$(".errMsg").remove(),chkSts==1&&(clearInterval(interval),$("#startChat").trigger("click"),chkSts=0),isValid=!0):($("#status").text("Not available"),$("#status").removeClass("available"),$("#status").addClass("offline"),$("#agtName").val(""),$(".dvAgtNa").hide(),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgtNa"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").show(),isValid=!1):($("#status").text("Not available"),$("#status").removeClass("available"),$("#status").addClass("offline"),$("#agtName").val(""),$(".dvAgtNa").hide(),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgtNa"),$(".dvFormDetails").hide(),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").show(),isValid=!1);break;case"Busy":$("#status").text("Not available (on a call)");$("#status").removeClass("available");$("#status").addClass("offline");$("#agtName").val("");$(".dvAgtNa").hide();isValid=!1;$(".dvFormDetails").hide();$(".dvChatHeader span:nth-child(3)").hide();$(".dvChatHeader span:nth-child(4)").hide();$(".dvAgentDetails").show();break;default:$(".dvAgentDetails").is(":visible")||($(".dvFormDetails").slideUp("fast"),$(".dvAgtNa").slideUp(),$("#status").switchClass("available","offline").text("Not available"),$("#agtName").val(""),$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgtNa"),$(".dvChatHeader span:nth-child(3)").hide(),$(".dvChatHeader span:nth-child(4)").hide(),$(".dvAgentDetails").hide().slideDown("slow"));isValid=!1}}else isValid=!1,$(".dvAgentDetails").slideUp("slow"),$(".dvFormDetails").slideUp("fast"),clearInterval(interval),echk="",$(".errMsg").is(":visible")||$('<span class="errMsg">Agent is not available, please select other option or agent.<\/div>').insertAfter(".dvAgtNa");if(isValid==!0){n();return}}}))}if(isValid==!0&&u==!1){n();return}});$("input[type=radio][name=rdBtn]").change(function(){this.value==="99"?($(".errMsg").is(":visible")?$(".errMsg").hide():$(".errMsg").show(),$(".dvAgtNa").show()):($(".errMsg").remove(),$(".errMsg").is(":visible")?$(".errMsg").hide():$(".errMsg").show(),$(".dvAgtNa").hide(),$("#agtstatus").val("1"),$("#agtName").val(""))});$("#spExpand").click(function(){$(".dvSchedule").is(":visible")==!0?($("#spExpand").removeClass("collapsed"),$(".dvSchedule").hide()):($("#spExpand").addClass("collapsed"),$(".dvSchedule").show())});$("#firstName").click(function(){$(this).removeAttr("style")});$("#clientEmail").click(function(){$(".errMsg").remove();$(this).removeAttr("style")});$("#question").click(function(){$(this).removeAttr("style")});$("#agtName").focus(function(){$(".errMsg").remove();$(this).removeAttr("style")});$(":checkbox").click(function(){switch(this.name){case"transcript":this.value=="true"?($(this).prop("checked",!0),$("#transno").prop("checked",!1)):($(this).prop("checked",!0),$("#transyes").prop("checked",!1));break;case"resolve":this.value=="true"?($(this).prop("checked",!0),$("#resno").prop("checked",!1)):($(this).prop("checked",!0),$("#resyes").prop("checked",!1));break;case"firstTime":this.value=="true"?($(this).prop("checked",!0),$("#timeno").prop("checked",!1)):($(this).prop("checked",!0),$("#timeyes").prop("checked",!1))}});$("#submitSurvey").click(function(){var t="null",i="null",r="",u="null",f="null",e="null",o=$("#formSurvey").serialize(),n=$("#formsurvey").serializeObject();"politeness"in n?t=n.politeness:"";"proficiency"in n?i=n.proficiency:"";"rating"in n?u=n.rating:"";"resolve"in n?f=n.resolve:"";"firstTime"in n?e=n.firstTime:"";"comments"in n?r=encodeURIComponent(n.comments):"";ContactId!=""&&$.ajax({type:"POST",url:"/Api/PostSurvey",contentType:"application/json; charset=utf-8",dataType:"json",data:'{"transcript":'+n.transcript+', "politeness":"'+t+'", "proficiency":"'+i+'", "comments":"'+r+'", "resolve":"'+f+'", "firstTime":"'+e+'", "rating":"'+u+'", "contactId":"'+ContactId+'"}',success:function(){$("#section-main").show("slide");$(".section-survey").hide("slide");ContactId="";agentMsgToSurvey=0;resetSurvey()},error:function(n){alert(n.responseText+" = error")}})})});$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value||"")):n[this.name]=this.value||""}),n};