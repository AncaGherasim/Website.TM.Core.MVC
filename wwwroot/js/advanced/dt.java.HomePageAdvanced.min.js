function doAjaxOnReady(){$.ajax({type:"Get",url:SiteName+"/Api/Packages/depCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){var t=n;depCities=$.map(t,function(n){var t=n.plC_Code?n.plC_Code.trim():"";if(t.toLowerCase()!=="none")return{label:n.plC_Title+" - "+n.plC_Code,value:n.plC_Title,id:n.plcid}});doitDep()},error:function(){}});$.ajax({type:"Get",url:SiteName+"/Api/Packages/priorCity",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){jsonDataArr=n;arrivalCities=$.map(jsonDataArr,function(n){return{label:n.ctyNA+" ("+n.couNA+")  - "+n.ctyCOD,value:n.ctyNA+" ("+n.couNA+")",id:n.ctyID,code:n.ctyCOD,dept:n.deptNA,hotapi:n.hotelAPI}});cookieCheck()},error:function(){}})}function winlocation(n){window.location=n}function buildFromCook(n){var t=JSON.parse(getItemF("localStorageTMAdvancedBYO")),i=0,u=Object.keys(t).length,r;n===1&&jQuery.each(t,function(n,t){n==="qWair"?t==="False"?$(".dvIntlFly").find('span:contains("Without Air")').trigger("click"):$(".dvIntlFly").find('span:contains("With Air")').trigger("click"):"";n==="qCabinOpt"?$('#qCabinOpt option[value="'+t+'"]').attr("selected","selected"):"";/qNACity/.test(n)===!0?(n.match(isNumber)>1?$(".dvByoCalButtons").find('span:contains("ADD DESTINATION")').trigger("click"):"",$("#"+n+"").val(t)):"";/qIDCity|qSTCity|qCOCity|qAPICity|qLeave|qReturnNA|qArrDate/.test(n)===!0?$("#"+n+"").val(t):"";/qgoingID/.test(n)===!0?($("#"+n+"").val(t),r=t):"";i+=1;i===u?(removeItemF("localStorageTMAdvancedBYO"),dateByDest(r)):""})}function startAgain(n){var t=n.innerHTML;switch(!0){case/Without/.test(t):$(".dvIntlFly").find('span:contains("Without")').trigger("click");break;case/With Air/.test(t):$(".dvIntlFly").find('span:contains("With Air")').trigger("click")}$("#xcabinRoomPax").val("1 Room, 2 Travelers, Economy");$("#xiRoomsAndPax").val("1|2");selectRoomPax("1|2");$("select[id^='xiAdults']").val("");$("select[id^='xiChild']").val("");$("select[id^='xRoom2_iAdults']").val("");$("select[id^='xRoom2_iChild']").val("");$("select[id^='xRoom3_iAdults']").val("");$("select[id^='xRoom3_iChild']").val("");$("#myModal, .modal-content").slideUp();$(".dvTransportation").hide().removeAttr("style");$(".dvMask").hide().removeAttr("height");$("div.dvtranspCityList").remove();$("#dvTranspError").hide()}function withAir(n){$(n).className==="spselect"?"":($(".dvIntlFly .spselect").removeClass("spselect"),$(n).addClass("spselect"),/Without/.test(n.innerHTML)===!0?hideAir("H"):hideAir("S"))}function hideAir(n){n==="H"?($(".dvAirParam").slideUp("slow"),$("#qWair").val("False")):($(".dvAirParam").slideDown("slow"),$("#qWair").val("True"))}function doitDep(){$("#qLeaveNA").autocomplete({autoFocus:!0,source:depCities,minLength:3,response:function(n,t){if(t.content.length===0)return alert("No valid airport found"),!1},select:function(n,t){return $("#qLeaveNA").val(t.item.value),$("#qLeaveID").val(t.item.id),$("#qReturnNA").is(":visible")&&($("#qReturnNA").val(t.item.value),$("#qReturnID").val(t.item.id)),!1},close:function(n){var i=$("#"+n.target.id+"").val();if($("#"+n.target.id+"").val().length>=3&&$("#"+n.target.id.replace("NA","ID")+"").val()=="-1"){var r=$(this).data("ui-autocomplete").menu.element[0].children[0],u=$(".ui-autocomplete"),f=u.val(),t=$(r).text();$("#"+this.id+"").val(t.substring(0,t.indexOf("-")));t=="No result found"?($("#"+n.target.id.replace("NA","ID")+"").val("-1"),$("#"+n.target.id+"").val(i)):$.map(depCities,function(i){$.each(i,function(r){r.label==t&&($("#"+n.target.id.replace("NA","ID")+"").val(i.id),$("#"+n.target.id.replace("NA","CO")+"").val(i.code))})})}}}).click(function(){$("#qLeaveNA").select().removeClass("errorClass");$("#"+this.id.replace("NA","ID")+"").val("-1");$("#qReturnNA").is(":visible")&&$("#qReturnID").val("-1");IsMobileDevice()&&$("#qLeaveNA").val("")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)};$("#qReturnNA").is(":visible")&&($("#qReturnNA").autocomplete({autoFocus:!0,source:depCities,minLength:3,response:function(n,t){if(t.content.length===0)return alert("No valid airport found"),!1},select:function(n,t){return $("#qReturnNA").val(t.item.value),$("#qReturnID").val(t.item.id),!1},close:function(n){var i=$("#"+n.target.id+"").val();if($("#"+n.target.id+"").val().length>=3&&$("#"+n.target.id.replace("NA","ID")+"").val()=="-1"){var r=$(this).data("ui-autocomplete").menu.element[0].children[0],u=$(".ui-autocomplete"),f=u.val(),t=$(r).text();$("#"+this.id+"").val(t.substring(0,t.indexOf("-")));t=="No result found"?($("#"+n.target.id.replace("NA","ID")+"").val("-1"),$("#"+n.target.id+"").val(i)):$.map(depCities,function(i){$.each(i.label,function(){i.label==t&&($("#"+n.target.id.replace("NA","ID")+"").val(i.id),$("#"+n.target.id.replace("NA","CO")+"").val(i.code))})})}}}).click(function(){$("#qReturnNA").select().removeClass("errorClass");$("#qReturnID").val("-1");IsMobileDevice()&&$("#qReturnNA").val("")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightText(this.term,i),$("<li><\/li>").append(i).appendTo(n)})}function dateByDest(){$("#qArrDate").datepicker("destroy");var n="";n=new Date(myDate.getTime()+6048e5);$("#qArrDate").datepicker({defaultDate:n,changeMonth:!1,changeYear:!1,numberOfMonths:2,showButtonPanel:!0,format:"yyyy-mm-dd",hideIfNoPrevNext:!0,prevText:"",nextText:"",minDate:n,maxDate:"+1Y",showOtherMonths:!1,beforeShow:function(){$(this).removeClass("errorClass")}})}function qaddCity(n){var i=n.id.split(","),e=Number(i[0]),t=Number(i[1]),r,u;if(Number(t)>12)return f,alert("For best results, no more than 12 cities is allowed. Thanks."),!1;if(Number(t)<=12){let i="",n="";for(let t=1;t<=14;t++)n=n+`<option value="${t}" ${t===3?"selected":""}>${t} ${t>1?"nights":"night"} </option>`;i=`<!-- div city ${t} -->
		 <div class="dvByoCalCity" id="dvCity${t}" style="margin-top:10px">
		   <div>
		     <input id="qNACity${t}" type="text" name="qNACity${t}" value="City or airport" />
		     <input type="hidden" name="qIDCity${t}"  id="qIDCity${t}" value="-1" />
		     <input name="qCOCity${t}" type="hidden" id="qCOCity${t}" value=""/>
		     <input name="qAPICity${t}" type="hidden" id="qAPICity${t}" value="" />
		   </div>
		   <div>
		     <span class="spRemoveCity" id="cty${t}" onclick="qdeleteCty(this)">Remove City</span>
		   </div>
		   <div>
		     <select name="qSTCity${t}" id="qSTCity${t}">
               ${n}
             </select>
		   </div>
		   <br style="clear:both" />		</div>`;r=$("#dvCity"+e);$(i).insertAfter(r);doitArr();u=Number(t)+1;$(".btnAddCty").attr("id",t+","+u);$("#qNACity"+t).keypress(function(){$("#"+this.id).val().length==1&&$("#qIDCity"+t).val(-1)})}}function qdeleteCty(n){var u=Number(n.id.match(isNumber)),f=u+1,r,t;for(r=$(".dvByoCalCity").length,$("#dvCity"+u+"").remove(),$(".btnAddCty").attr("id",Number(r-1)+","+Number(r)),i=f;i<=r;i++)$("#dvCity"+i+"").length>0&&(t=i-1,$("#dvCity"+i+"").attr("id","dvCity"+t+""),$("#qNACity"+i+"").attr("name","qNACity"+t+""),$("#qNACity"+i+"").attr("id","qNACity"+t+""),$("#qIDCity"+i+"").attr("name","qIDCity"+t+""),$("#qIDCity"+i+"").attr("id","qIDCity"+t+""),$("#qCOCity"+i+"").attr("name","qCOCity"+t+""),$("#qCOCity"+i+"").attr("id","qCOCity"+t+""),$("#qAPICity"+i+"").attr("name","qAPICity"+t+""),$("#qAPICity"+i+"").attr("id","qAPICity"+t+""),$("#cty"+i+"").attr("id","cty"+t+""),$("#qSTCity"+i+"").attr("name","qSTCity"+t+""),$("#qSTCity"+i+"").attr("id","qSTCity"+t+""),$("#cty"+i+"").attr("id","cty"+t+""),doitArr(t))}function byoValidation(){if($("#qWair").val()==="True"){if($("#qLeaveID").val()==="-1")return errorAlert("qLeaveNA","Select a valid city or airport"),!1;if($("#qReturnNA").is(":visible")&&$("#qReturnID").val()==="-1")return errorAlert("qReturnNA","Select a valid city or airport to return to"),!1}if(/\//.test($("#qArrDate").val())===!1)return errorAlert("qArrDate","Date is not valid"),!1;var n=0;$('form#formBYO input[id^="qIDCity"]').each(function(){this.value==="-1"&&$("#"+this.id.replace("ID","NA")+"").val()=="City or airport"?(errorAlert(this.id.replace("ID","NA"),"Select a valid city or airport"),n-=1):this.value==="-1"&&(errorAlert(this.id.replace("ID","NA"),$("#"+this.id.replace("ID","NA")+"").val()),n-=1);n+=1;n===$('form#formBYO input[id^="qIDCity"]').length?submitForm("formBYO"):""})}function submitForm(n){var i,r,t;openMask();$(".dvTransportation").show().css({position:"absolute"});i="";i=JSON.stringify($("#formBYO").serializeObject());i=JSON.parse(i);delete i.__RequestVerificationToken;i=JSON.stringify(i);setItemF("localStorageTMAdvancedBYO",i,1);r="";r=$("#"+n+"").serialize();t={};t.url=SiteName+"/Api/Packages/webservTransportationOption";t.type="POST";t.contentType="application/json";t.data=JSON.stringify(r);t.dataType="json";t.success=function(n){cityData=n.Cities;buildTransportationFrom()};t.error=function(n){console.log(n)};$.ajax(t)}function findNextCity(n){var i="",t=[];return t=jsonDataArr,t=$.grep(t,function(t){return t.ctyID==n}),jQuery.each(t,function(){i=this.ctyNA}),i}function buildTransportationFrom(){var n;$(".dvSpin").hide();$(".dvtranspByoCalTools").show();n=JSON.parse(getItemF("localStorageTMAdvancedBYO"));$("#xaddFlight").val(n.qWair);n.qWair==="True"?($('span:contains("With Air")').addClass("spselect"),$('span:contains("Without")').removeClass("spselect"),$(".dvtranspAirParam").show()):"";n.qWair==="False"?($('span:contains("Without")').addClass("spselect"),$('span:contains("With Air")').removeClass("spselect"),$(".dvtranspAirParam").hide()):"";$("#xLeaveCO").val(n.qLeaveNA);$("#xReturnCO").val(n.qReturnNA);$("#xtxtLeavingFrom").val(decodeURIComponent(n.qLeaveNA));$("#xidLeavingFrom").val(n.qLeaveID);$("#xtxtReturningTo").val(decodeURIComponent(n.qReturnNA));$("#xidReturningTo").val(n.qReturnID);$("#xtxtBYArriving").val($("#qArrDate").val());$('#xCabin option[value="'+n.qCabinOpt+'"]').attr("selected","selected");$("#xgoingID").val(n.qgoingID);var i=[],t="",r=0,u=0,f=length(n)-1;$.each(n,function(n,e){n.match(/\d+/g)!=null&&(r!=n.match(/\d+/g)&&(r=Number(n.match(/\d+/g)),r>1?(i.push(t),t=""):"",t=t+n.match(isNumber)+"@"+e),/qNACity/.test(n)===!1?t=t+"@"+e:"");u++;u===f?(i.push(t),t="",buildTransportationTo(i),dvTrans=""):""})}function buildTransportationTo(n){var t,o,r,e,u,f;try{if(t="",o=cityData.length,o===undefined){r=JSON.parse(JSON.stringify(cityData));e=n[0].split("@");let u="";for(i=1;i<=14;i++)u=u+`<option value="${i}" ${i==e[5]?"selected":""}>${i} ${i>1?"nights":"night"}</option>`;t=t+`<div id="cityTo${r.No}" class="dvtranspCityList">
				 <!-- City Name / ${this.No} /-->
				   <div>
                     <span>${r.No}. <b>${decodeURIComponent(r.PlaceName.replace(/\+/g," "))}</b></span>
				     <input type="hidden" id="xNOCity${r.No}" name="xNOCity${r.No}" value="${r.No}" />
				     <input name="xNACity${r.No}" type="hidden" id="xNACity${r.No}" value="${decodeURIComponent(r.PlaceName.replace("+"," "))}"/>
				     <input type="hidden" name="xIDCity${r.No}"  id="xIDCity${r.No}" value="${r.PlaceID}"/>
				     <input name="xCOCitx${r.No}" type="hidden" id="xCOCitx${r.No}" value="${e[3].trim()}"/>
				     <input name="xAPICity${r.No}" type="hidden" id="xAPICity${r.No}" value="${e[4].replace(/\%\7C/g,"|").trim()}"/>
				   </div>
				 <!-- Date / Edit-Remove -->
				   <div>
				     <span>
                       ${this.No==="1"?`<b>${$("#qArrDate").val()}</b>`:'<span class="sptranspRemoveCity goToStartAgain">Edit/Remove<\/span>'}                  
                     </span>
                   </div>
				 <!-- Staying for -->
				   <div>
                     <span>
				       <select name="xSTCity${r.No}" id="xSTCity${r.No}">
                         ${u}
                       </select>
				     </span>
				  </div>
                  <br style="clear:both;">
                 </div>`}else u="",f=0,$.each(cityData,function(){var c=findNextCity(this.PlaceToID),a,b,w,p,h,l,e;if(isNaN(Number(this.No))===!0){if(this.No==="S"){if(a=n[0].split("@"),t=t+'<div id="cityTo'+this.No+'" class="dvtranspCityList" style="margin:0"><!-- City Name / S /--><div><span><font size="3">&#8224;<\/font> Must arrive to <b>'+decodeURIComponent(this.PlaceName)+'<\/b> <\/span><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+decodeURIComponent(this.PlaceName)+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+this.PlaceID+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+a[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+a[4].replace(/\%\7C/g,"|").trim()+'"/><\/div><!-- Date / Edit-Remove --><div><span><\/span><\/div><!-- Staying for --><div> <span><input type="hidden" id="xSTCity'+this.No+'" name="xSTCity'+this.No+'" value="0"/><\/span><\/div><div>',this.Options!==null){var e="",s='<!-- Checkboxes for trasnsport options --><p class="ptranspCheck" id="pCheckBox'+this.No+'">',r=this.No,v=this.Options,h="ptranspSelAct",y=1;t=t+"<!-- Transport options -->";v.Ranking===undefined?$.each(v,function(){var n,i;this.Ranking===1?(t=t+'<input name="xFIELDCityS" type="hidden" id="xFIELDCityS" value="'+this.ProductFreeField1+'"/>',t=t+'<input name="xTRANSCityS" type="hidden" id="xTRANSCityS" value="'+this.ProductType+'"/>',t=t+'<input type="hidden" id="xOVNCityS" name="xOVNCityS" value="'+this.Overnight+'"/>',s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" checked type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span><b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',h="ptranspSelNoAct"):(s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span> <b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to $$"+a[1]:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',y++);this.ProductType==="C"&&(n='style="display:none"',this.Ranking===1?n='style="display:block"':"",e=e+'<!-- CAR options / parameters --><span class="dvCarOpt" id="carOptions'+r+'" '+n+'><p class="dvCarUpOff" id="pickup'+r+'"><span>Pick-up<\/span><select name="xpickupPlaceCity'+r+'" id="xpickupPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xpickupDayCity'+r+'" id="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><br style="clear:both;"><\/p><p class="dvCarUpOff" id="trdropOff'+r+'"><span>Drop-off<\/span><select name="xdropoffPlaceCity'+r+'" id="xdropoffPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xdropoffDayCity'+r+'" id="xdropoffDayCity'+r+'"><option value="L">Last Day<\/option><option value="F">First Day<\/option><\/select><select name="xdropoffCity'+r+'" id="xdropoffCity'+r+'" class="selectDropOffCity" data-city="'+r+'">',this.CarDropOff.DOCity.DOPlaceNo!==undefined?(e=e+'<option value="'+this.CarDropOff.DOCity.DOPlaceNo+'">'+this.CarDropOff.DOCity.DOPlaceNo.replace(/\+/g," ")+". "+decodeURIComponent(this.CarDropOff.DOCity.DOPlaceName)+"<\/option>",this.Ranking===1&&(f=this.CarDropOff.DOCity.DOPlaceNo,u=r)):(i=this.CarDropOff.DOCity,this.Ranking===1&&(f=i[0].DOPlaceNo,u=r),$.each(i,function(){e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName)+"<\/option>"})),e=e+'<\/select><br style="clear:both;"><\/p><\/span>')}):($.each(v,function(){var i,n;this.Ranking===1&&(t=t+'<input name="xFIELDCityS" type="hidden" id="xFIELDCityS" value="'+this.ProductFreeField1+'"/>',t=t+'<input name="xTRANSCityS" type="hidden" id="xTRANSCityS" value="'+this.ProductType+'"/>',t=t+'<input type="hidden" id="xOVNCityS" name="xOVNCityS" value="'+this.Overnight+'"/>',s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" checked type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span><b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',h="ptranspSelNoAct");this.ProductType==="C"&&(i='style="display:none"',this.Ranking===1?i='style="display:block"':"",e=e+'<!-- CAR options / parameters --><span class="dvCarOpt" id="carOptions'+r+'" '+i+'><p class="dvCarUpOff" id="pickup'+r+'"><span>Pick-up<\/span><select name="xpickupPlaceCity'+r+'" id="xpickupPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xpickupDayCity'+r+'" id="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><br style="clear:both;"><\/p><p class="dvCarUpOff" id="trdropOff'+r+'"><span>Drop-off<\/span><select name="xdropoffPlaceCity'+r+'" id="xdropoffPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xdropoffDayCity'+r+'" id="xdropoffDayCity'+r+'"><option value="L">Last Day<\/option><option value="F">First Day<\/option><\/select><select name="xdropoffCity'+r+'" id="xdropoffCity'+r+'" class="selectDropOffCity" data-city="'+r+'">',this.CarDropOff!==undefined?(n=this.CarDropOff.DOCity,$.each(n,function(){this.Ranking===1&&(f=this.DOPlaceNo,u=r);e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName)+"<\/option>"})):(n=this.CarDropOff.DOCity,this.Ranking===1&&(f=n[0].DOPlaceNo,u=r),$.each(n,function(){e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName.replace(/\+/g," "))+"<\/option>"})),e=e+'<\/select><br style="clear:both;"><\/p><\/span>')}),y=1);e=e+'<p id="pTranspSel'+r+"-"+Number(y+1)+'" class="ptranspSelNoAct"><span><b>On your own<\/b> to '+c+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>';s=s+'<input data-type="W" data-field="OWN" data-ovrnts="0" data-rank="'+Number(y+1)+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>On your own<\/span>';t=t+s+"<\/p>"+e}t=t+'<\/div><br style="clear:both;"><\/div>'}this.No==="E"&&(b=Number(n.length-1),w=n[b].split("@"),t=t+'<div id="cityTo'+this.No+'" class="dvtranspCityList"><!-- City Name / E /--><div><span><font size="3">&raquo;<\/font> Must depart from <b>'+decodeURIComponent(this.PlaceName)+'<\/b> <\/span><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+decodeURIComponent(this.PlaceName)+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+this.PlaceID+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+w[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+w[4].replace(/\%\7C/g,"|").trim()+'"/><input type="hidden" id="xSTCity'+this.No+'" name="xSTCity'+this.No+'" value="0"/><input type="hidden" id="xOVNCity'+this.No+'" name="xOVNCity'+this.No+'" value="0"/><\/div><!-- Date / Edit-Remove --><div><span><\/span><\/div><!-- Staying for --><div> <span><\/span><\/div><br style="clear:both;"><\/div>')}else{for(p=n[Number(this.No-1)].split("@"),t=t+'<div id="cityTo'+this.No+'" class="dvtranspCityList"><!-- City Name / '+this.No+" /--><div><span>"+this.No+". <b>"+decodeURIComponent(this.PlaceName.replace(/\+/g," "))+'<\/b><\/span><input type="hidden" id="xNOCity'+this.No+'" name="xNOCity'+this.No+'" value="'+this.No+'" /><input name="xNACity'+this.No+'" type="hidden" id="xNACity'+this.No+'" value="'+this.PlaceName.replace("+"," ")+'"/><input type="hidden" name="xIDCity'+this.No+'"  id="xIDCity'+this.No+'" value="'+this.PlaceID+'"  /><input name="xCOCitx'+this.No+'" type="hidden" id="xCOCitx'+this.No+'" value="'+p[3].trim()+'"/><input name="xAPICity'+this.No+'" type="hidden" id="xAPICity'+this.No+'" value="'+p[4].replace(/\%\7C/g,"|").trim()+'"/><\/div><!-- Date / Edit-Remove --><div><span>',t=this.No==="1"?t+"<b>"+$("#qArrDate").val()+"<\/b>":t+'<span class="sptranspRemoveCity goToStartAgain">Edit/Remove<\/span>',t=t+'<\/span><\/div><!-- Staying for --><div> <span><select name="xSTCity'+this.No+'" id="xSTCity'+this.No+'">',i=1;i<=14;i++)t=i==p[5]?t+'<option value="'+i+'" selected>'+i+" nights<\/option>":t+'<option value="'+i+'">'+i+" nights<\/option>";if(t=t+"<\/select><\/span><\/div><div>",h="ptranspSelAct",l=1,this.Options!==null){var r=this.No,e="",s='<!-- Checkboxes for trasnsport options --><p class="ptranspCheck" id="pCheckBox'+this.No+'">',k=this.Options;if(this.Options[0].Ranking!==null)$.each(k,function(){var i,n;this.Ranking===1?(t=t+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="'+this.ProductFreeField1+'"/>',t=t+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="'+this.ProductType+'"/>',t=t+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="'+this.Overnight+'"/>',s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" checked type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span><b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',h="ptranspSelNoAct"):(s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span> <b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',l++);this.ProductType==="C"&&(i='style="display:none"',this.Ranking===1?i='style="display:block"':"",e=e+'<!-- CAR options / parameters --><span class="dvCarOpt" id="carOptions'+r+'" '+i+'><p class="dvCarUpOff" id="pickup'+r+'"><span>Pick-up<\/span><select name="xpickupPlaceCity'+r+'" id="xpickupPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xpickupDayCity'+r+'" id="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><br style="clear:both;"><\/p><p class="dvCarUpOff" id="trdropOff'+r+'"><span>Drop-off<\/span><select name="xdropoffPlaceCity'+r+'" id="xdropoffPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xdropoffDayCity'+r+'" id="xdropoffDayCity'+r+'"><option value="L">Last Day<\/option><option value="F">First Day<\/option><\/select><select name="xdropoffCity'+r+'" id="xdropoffCity'+r+'" class="selectDropOffCity" data-city="'+r+'">',this.CarDropOff!==null?(n=this.CarDropOff.DOCity,$.each(n,function(){this.Ranking===1&&(f=this.DOPlaceNo,u=r);e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName)+"<\/option>"})):(n=this.CarDropOff.DOCity,this.Ranking===1&&(f=n[0].DOPlaceNo,u=r),$.each(n,function(){e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName.replace(/\+/g," "))+"<\/option>"})),e=e+'<\/select><br style="clear:both;"><\/p><\/span>')}),e=e+'<p id="pTranspSel'+r+"-"+Number(l+1)+'" class="ptranspSelNoAct"><span><b>On your own<\/b> to '+c+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',s=s+'<input data-type="W" data-field="OWN" data-ovrnts="0" data-rank="'+Number(l+1)+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>On your own<\/span>',t=t+s+"<\/p>"+e;else{l=1;var v=this.Options,e="",s='<!-- Checkboxes for trasnsport options --><p class="ptranspCheck" id="pCheckBox'+r+'">',h="ptranspSelAct";$.each(v,function(){var n,i;this.Ranking===1?(t=t+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="'+this.ProductFreeField1+'"/>',t=t+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="'+this.ProductType+'"/>',t=t+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="'+this.Overnight+'"/>',s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" checked type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span><b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',h="ptranspSelNoAct"):(s=s+'<input data-type="'+this.ProductType+'" data-field="'+this.ProductFreeField1+'" data-ovrnts="'+this.Overnight+'" data-rank="'+this.Ranking+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>'+this.ProductTypeName+"&nbsp;&nbsp;<\/span>",e=e+'<!-- Trasport option selected label --><p id="pTranspSel'+r+"-"+this.Ranking+'" class="'+h+'"><span> <b>'+this.ProductTypeName+"<\/b>",this.ProductType!="C"?e=e+" to "+c:"",e=e+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>',l++);this.ProductType==="C"&&(n='style="display:none"',this.Ranking===1?n='style="display:block"':"",e=e+'<!-- CAR options / parameters --><span class="dvCarOpt" id="carOptions'+r+'" '+n+'><p class="dvCarUpOff" id="pickup'+r+'"><span>Pick-up<\/span><select name="xpickupPlaceCity'+r+'" id="xpickupPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xpickupDayCity'+r+'" id="xpickupDayCity'+r+'"><option value="F">First Day<\/option><option value="L">Last Day<\/option><\/select><br style="clear:both;"><\/p><p class="dvCarUpOff" id="trdropOff'+r+'"><span>Drop-off<\/span><select name="xdropoffPlaceCity'+r+'" id="xdropoffPlaceCity'+r+'"><option value="A">Airport<\/option><\/select><select name="xdropoffDayCity'+r+'" id="xdropoffDayCity'+r+'"><option value="L">Last Day<\/option><option value="F">First Day<\/option><\/select><select name="xdropoffCity'+r+'" id="xdropoffCity'+r+'" class="selectDropOffCity" data-city="'+r+'">',this.CarDropOff.DOCity.DOPlaceNo!==undefined?(e=e+'<option value="'+this.CarDropOff.DOCity.DOPlaceNo+'">'+this.CarDropOff.DOCity.DOPlaceNo+". "+decodeURIComponent(this.CarDropOff.DOCity.DOPlaceName.replace(/\+/g," "))+"<\/option>",this.Ranking===1&&(f=this.CarDropOff.DOCity.DOPlaceNo,u=r)):(i=this.CarDropOff.DOCity,this.Ranking===1&&(f=i[0].DOPlaceNo,u=r),$.each(i,function(){e=e+'<option value="'+this.DOPlaceNo+'">'+this.DOPlaceNo+". "+decodeURIComponent(this.DOPlaceName)+"<\/option>"})),e=e+'<\/select><br style="clear:both;"><\/p><\/span>')});e=e+'<p id="pTranspSel'+r+"-"+Number(l+1)+'" class="ptranspSelNoAct"><span><b>On your own<\/b> to '+c+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>';s=s+'<input data-type="W" data-field="OWN" data-ovrnts="0" data-rank="'+Number(l+1)+'" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>On your own<\/span>';t=t+s+"<\/p>"+e}}else if(this.No<o&&c!=""){var r=this.No,h="ptranspSelAct",s="<!-- Checkboxes for trasnsport options -->";u!=0&&(u<this.No||u=="S")&&(f=="E"||Number(f)>this.No)&&(h="ptranspSelNoAct");s=s+'<input name="xFIELDCity'+r+'" type="hidden" id="xFIELDCity'+r+'" value="OWN"/>';s=s+'<input name="xTRANSCity'+r+'" type="hidden" id="xTRANSCity'+r+'" value="W"/>';s=s+'<input type="hidden" id="xOVNCity'+r+'" name="xOVNCity'+r+'" value="0"/><p class="ptranspCheck" id="pCheckBox'+r+'"><input data-type="OWN" data-field="W" data-ovrnts="0" data-rank="1" id="xradioTrans'+r+'" name="xradioTrans'+r+'" class="checkBox" value="'+r+'" type="radio"><span>On your own<\/span>';e='<!-- Trasport option selected label --><p id="pTranspSel'+r+'-1" class="'+h+'"><span><b>On your own<\/b> to '+c+'<\/span><span><input class="buttontranspChange" value="change" id="'+r+'" type="button"><\/span> <br style="clear:both"><\/p>';t=t+s+e}t=t+"<\/div>";t=t+'<br style="clear:both"/>';t=t+"<\/div>"}});$("#dvWaitGlobe").html("").hide();$(".dvtranspMainContainer").show();$("#dvTranspError").hide();$(t).insertAfter(".dvtranspLabels");$(".buttontranspChange").click(function(){changeTranspOption(this)});$(".selectDropOffCity").change(function(){carSelected($(this).data("city"))});$(".checkBox").click(function(){modifyTransportation(this,this.value)});$(".goToStartAgain").click(function(){startAgain(this)});t=""}catch(s){buildTransportationError(s.message)}}function buildTransportationError(n){$(".goToStartAgain").click(function(){startAgain(this)});var i=JSON.parse(getItemF("localStorageTMAdvancedBYO")),r=0,u=Object.keys(i).length,t="";jQuery.each(i,function(i,f){/qNACity/.test(i)===!0?t=t+"<li>"+f+"<\/li>":"";r+=1;r===u?(removeItemF("localStorageTMAdvancedBYO"),$("#sptrancities").html(t),$("#perrorCode").html(n),$(".dvWaitGlobe").hide(),$(".dvtranspMainContainer").hide(),$("#dvTranspError").show()):""})}function length(n){return Object.keys(n).length}function changeTranspOption(n){$('p[id^="pTranspSel'+n.id+'"]').each(function(){this.className==="ptranspSelAct"?$(this).attr("class","ptranspSelNoAct"):""});$("#pCheckBox"+n.id+"").show()}function modifyTransportation(n,t){$("#xFIELDCity"+t+"").val($(n).data("field"));$("#xTRANSCity"+t+"").val($(n).data("type"));$("#xOVNCity"+t+"").val($(n).data("ovrnts"));$("#pCheckBox"+t+"").hide();$("#pTranspSel"+t+"-"+$(n).data("rank")+"").attr("class","ptranspSelAct");$(n).data("type")==="C"?($("#carOptions"+t+"").show(),carSelected(t)):($("#carOptions"+t+"").hide(),carNoSelected(t))}function carSelected(n){var i=$(".dvtranspCityList").length,u=n,r,t;for(u==="S"?(u=1,i=Number(i)-1):u=Number(u)+1,r=$("#xdropoffCity"+n+"").val(),r==="E"?$("#cityToS").length===1?(r=$(".dvtranspCityList").length-1,i=Number(i)-1):r=i:"",t=u;t<=i;t++)if(t<r?($("#xFIELDCity"+t+"").val(""),$("#xTRANSCity"+t+"").val(""),$('p[id^="pTranspSel'+t+"").attr("class","ptranspSelNoAct"),$("#carOptions"+t+"").is(":visible")===!0?$($("#carOptions"+t+"").hide()):""):"",t>=r){let n=!1;$('p[id^="pTranspSel'+t+'"]').each(function(){this.className=="ptranspSelAct"?n=!0:""});n||($("#xFIELDCity"+t+"").val($("#xradioTrans"+t+'[data-rank="1"]').data("field")),$("#xTRANSCity"+t+"").val($("#xradioTrans"+t+'[data-rank="1"]').data("type")),$("#xradioTrans"+t+'[data-rank="1"]').prop("checked",!0),$('p[id^="pTranspSel'+t+"-1").attr("class","ptranspSelAct"));$("#xFIELDCity"+t+"").val()==="TBA"?($("#carOptions"+t+"").show(),t++):""}}function carNoSelected(n){var i=$(".dvtranspCityList").length,r=n,u,t;for(r==="S"?(r=1,i=Number(i)-1):r=Number(r)+1,u=$("#xdropoffCity"+n+"").val(),u==="E"?$("#cityToS").length===1?(u=$(".dvtranspCityList").length-1,i=Number(i)-1):u=i:"",t=r;t<=i;t++){let n=!1;$('p[id^="pTranspSel'+t+'"]').each(function(){this.className=="ptranspSelAct"?n=!0:""});n||($("#xFIELDCity"+t+"").val($("#xradioTrans"+t+'[data-rank="1"]').data("field")),$("#xTRANSCity"+t+"").val($("#xradioTrans"+t+'[data-rank="1"]').data("type")),$("#xradioTrans"+t+'[data-rank="1"]').prop("checked",!0),$('p[id^="pTranspSel'+t+"-1").attr("class","ptranspSelAct"));$("#xFIELDCity"+t+"").val()==="TBA"?($("#carOptions"+t+"").show(),t++):""}}function openMask(){var n=$(document).height();$(".dvMask").css({height:n});$(".dvMask").fadeIn(1e3);$(".dvMask").fadeTo("slow",.9)}function errorAlert(n,t){var i=$("#"+n+"").position();return $("#"+n+"").addClass("errorClass").val(t),window.scroll(0,i.top-100),!1}function replacePicture(n,t,i,r){var u;u=r==="none"?picSRC:"https://pictures.tripmasters.com"+r;/O/.test(n)===!1?($('img.picSel[id*="Kipic"]').attr("class","picNSel"),$('img.picSel[id*="Mipic"]').attr("class","picNSel"),$("#"+n+"").attr("class","picSel"),$(".dvFstPic").html('<img src="'+u.toLowerCase()+'" id="'+n.replace("O","B")+'"  alt="'+r+'" title="'+i+'" />'),/M/.test(n)===!0?($("#dvMV").hide(),$("#Mipic"+n.match(isNumber)+"").attr("class","picSel")):($("#dvMV").show(),$("#dvPicNa").html(i))):($('img[id*="Oipic"]').attr("class","picNSel"),$("#"+n+"").attr("class","picSel"),/Map/.test(n)===!0||u.match(img500)===!0?($(".dvshowPIC").html('<img src="'+u.toLowerCase()+'" id="'+n.replace("O","B")+'" alt="'+r+'" title="'+i+'" width="290" height="290"  class="clsCursor"/>'),$(".selM").css("width","399px"),$("#dvallTHU").attr("style","width:258px;")):($(".dvshowPIC").html('<img src="'+u.toLowerCase()+'" id="'+n.replace("O","B")+'"  alt="'+r+'" title="'+i+'"  class="clsCursor"/>'),$(".selM").css("width","399px"),$("#dvallTHU").attr("style","width:258px;")))}function moreMediaCLS(){$(".dvMask").hide().removeAttr("height");$(".dvmediaPopUp").hide()}function otherMoreDetails(n,t,i){$(".dvIdeasInfo").each(function(){var i=$(this).attr("id"),r=i.match(isNumber);r==n?$("#"+i+"").is(":visible")==!1?($("#"+i+"").slideDown(),$("#dvArrow"+r+"").slideDown(),$('.dvEachIdeasMore[data-id="'+n+"|"+t+'"]').find("span").css("transform","rotate(-90deg)")):($("#"+i+"").slideUp(),$("#dvArrow"+r+"").slideUp(),$('.dvEachIdeasMore[data-id="'+n+"|"+t+'"]').find("span").removeAttr("style")):($("#"+i+"").slideUp(),$("#dvArrow"+r+"").slideUp(),$('.dvEachIdeasMore[data-id*="'+r+'"]').find("span").removeAttr("style"))});i===1?relPackCall(n,t):""}function relPackCall(n,t){var r="",u;switch(t){case"ED":case"TMED":u="europe";break;case"LD":case"TMLD":u="latin";break;case"TMAS":u="asia"}$.ajax({type:"POST",url:"/Api/Packages/getDataRelPacks",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({FaqQuestion:n,FaqResponse:t}),crossDomain:!0,success:function(t){if(msg=t.m_StringValue,msg!=""){for(r="<span>Related Package<br><\/span>",strPrts=msg.split("@"),i=0;i<=strPrts.length-1;i++)echP=strPrts[i].split("|"),r=r+'<a href="/'+u+"/"+echP[0].replace(/\s/g,"_")+'/vacations" style="margin-right:10px"><u>'+echP[0]+" ("+echP[1]+")<\/u><\/a>";$("#dvRelPack"+n+"").html(r+'<br style="clear:both"/>').slideDown("slow")}},error:function(t){console.log("Error: "+t.responseText);$("#dvWait"+n+"").html(t.responseText)}})}function scrollToTop(){$("body,html").animate({scrollTop:0},800)}function cookieCheck(){selectRoomPax("1|2");backCookie=getItemF("localStorageTMAdvancedBYO");backCookie!=null?(buildFromCook(1),doitArr()):(dateByDest(),doitArr())}function doitArr(){$('input[id^="qNACity"]').each(function(){var n=""+this.id+"";$(this).autocomplete({autoFocus:!0,source:function(n,t){var i;n.term.length<4?i=new RegExp("^"+$.ui.autocomplete.escapeRegex(n.term),"i"):n.term.length>=4&&(i=new RegExp("\\b"+$.ui.autocomplete.escapeRegex(n.term),"i"));t($.map(arrivalCities,function(n){if(i.test(n.value)||i.test(n.code))return n}))},minLength:3,response:function(t,i){if(i.content.length===0&&$("#"+n+"").val().length>=5)return $("#"+this.id.replace("NA","ID")+"").val("-1"),i.content.push({label:"No result found",value:""}),!1},select:function(n,t){$("#"+this.id+"").val(t.item.value).removeClass("errorClass");$("#"+this.id.replace("NA","ID")+"").val(t.item.id);$("#"+this.id.replace("NA","CO")+"").val(t.item.code);$("#"+this.id.replace("NA","API")+"").val(t.item.hotapi);var i=this.id.match(isNumber);return Number(i)===1&&$("#qgoingID, #xgoingID").val(t.item.dept),!1},close:function(t){var r=$("#"+t.target.id+"").val();if($("#"+n+"").val().length>=3&&$("#"+t.target.id.replace("NA","ID")+"").val()=="-1"){var u=$(this).data("ui-autocomplete").menu.element[0].children[0],f=$(".ui-autocomplete"),e=f.val(),i=$(u).text();$("#"+this.id+"").val(i.substring(0,i.indexOf("-")));i=="No result found"?($("#"+t.target.id.replace("NA","ID")+"").val("-1"),$("#"+t.target.id+"").val(r)):$.map(arrivalCities,function(n){$.each(n,function(){if(n.label==i){$("#"+t.target.id.replace("NA","ID")+"").val(n.id);$("#"+t.target.id.replace("NA","CO")+"").val(n.code);$("#"+t.target.id.replace("NA","API")+"").val(n.hotapi);var r=t.target.id.match(isNumber);Number(r)===1&&$("#qgoingID, #xgoingID").val(n.dept)}})})}}}).click(function(){$(this).select().removeClass("errorClass");$("#"+this.id.replace("NA","ID")+"").val("-1");$("#"+this.id+"").select();IsMobileDevice()&&$(this).val("")}).data("ui-autocomplete")._renderItem=function(n,t){var i=$("<span><\/span>").text(t.label);return highlightTextBYO(this.term,i),$("<li><\/li>").append(i).appendTo(n)}})}function highlightTextBYO(n,t){for(var f=$.trim(n).toLowerCase(),i=t.get(0).firstChild,e,u,r;(e=i.data.toLowerCase().indexOf(f))>=0;)u=i.splitText(e),i=u.splitText(f.length),r=document.createElement("span"),r.className="highlight",i.parentNode.insertBefore(r,i),r.appendChild(u)}function selectRoomPax(n){var t=n.split("|");$("#xiRoom").val(t[0]);$("#xRooms").val(t[0]);/Other/.test(n)===!0?(openRoom(t[0],1),$("#xiAdults").val(0)):(openRoom(t[0],0),$('#xiAdults option[value="'+t[1]+'"').attr("selected","selected"),otherCleanRoom())}function openRoom(n,t){t===0?$(".dvtranspAdultChild, #pPaxLabels").slideUp("fast"):$(".dvtranspAdultChild, #pPaxLabels").slideDown("fast");$('p[id^="pRoom"]').each(function(){this.id.match(isNumber)<=n?$(this).slideDown("slow"):($(this).slideUp("slow"),cleanRoom(this))})}function cleanRoom(n){$("#"+n.id+" select").each(function(){/_iAdults/.test(this.id)===!0?$("#"+this.id+"").val(0):/iChildren/.test("#"+this.id+"")===!0?$(this).val(0):/iChild/g.test(this.id)===!0?$("#"+this.id+"").val(-1):""})}function otherCleanRoom(){$('select[id*="iChild"]').each(function(){/iChildren/.test(this.id)===!0?$("#"+this.id+' option[value="0"]').attr("selected","selected"):"";/iChild/g.test(this.id)===!0?$("#"+this.id+' option[value="-1"]').attr("selected","selected"):""})}function childAge(n){var t,i,r;t=n.id.match(isNumber)===null?1:n.id.match(isNumber);i=n.value;$("#"+n.id+"").removeClass("errorClass");r=countPax(0);r>6?(alert("Max guest allowed (adults + children) are 6 !"),$("#"+n.id+"").addClass("errorClass")):($("#pChildAges").show(),$("#pChildAges"+t+"").show().find("select").each(function(){this.id.slice(-1).match(isNumber)<=Number(i)?($(this).show(),$('label[for="'+this.id+'"]').show()):($(this).hide().val(-1),$('label[for="'+this.id+'"]').hide("fast",function(){countChilds()<=0?$("#pChildAges").hide():""}))}))}function countChilds(){var n=0,t=0,i=0;return $("#pRoom1").is(":visible")===!0?n=Number($("#xiChildren").val()):"",$("#pRoom2").is(":visible")===!0?t=Number($("#xRoom2_iChildren").val()):"",$("#pRoom3").is(":visible")===!0?i=Number($("#xRoom3_iChildren").val()):"",n+t+i}function countPax(n){var o=n,e=-1,t=[],r=[],u=0,f=0,s=$("#xiRoomsAndPax").val();if($("#pRoom1").is(":visible")===!0?(e=0,t[0]=Number($("#xiAdults").val()),u=t[0],r[0]=Number($("#xiChildren").val()),f=r[0]):/Other/.test(s)===!1?t[0]=Number($("#xiAdults").val(),u=t[0]):"",$("#pRoom2").is(":visible")===!0?(e=1,t[1]=Number($("#xRoom2_iAdults").val()),u=t[0]+t[1],r[1]=Number($("#xRoom2_iChildren").val()),f=r[0]+r[1]):"",$("#pRoom3").is(":visible")===!0?(e=2,t[2]=Number($("#xRoom3_iAdults").val()),u=t[0]+t[1]+t[2],r[2]=Number($("#xRoom3_iChildren").val()),f=r[0]+r[1]+r[2]):"",u===0&&o===1)return alert("No adults on rooms !"),t[0]===0&&$("#xiAdults").addClass("errorClass"),t[1]===0&&$("#xRoom2_iAdults").addClass("errorClass"),t[2]===0&&$("#xRoom3_iAdults").addClass("errorClass"),!1;if(u>0&&o===1)for(i=0;i<=e;i++){if($ithis=i===0?$("#xiAdults"):$("#xRoom"+Number(i+1)+"_iAdults"),t[i]===0)return alert("No adults in room "+Number(i+1)+"!"),$ithis.addClass("errorClass"),!1;if(u+f>6)return alert("Max guest allowed (adults + children) are 6 !"),!1}else return u+f<=6&&$('p[id^="pRoom"]').find(".errorClass").length>0&&($('p[id^="pRoom"]').find(".errorClass").removeClass("errorClass"),$('select[id*="iChildren"]').each(function(){this.value>0?childAge(this):""})),u+f}function changeAdults(n){$("#"+n.id+"").removeClass("errorClass");var t=countPax(0);t>6&&(alert("Max guest allowed (adults + children) are 6 !"),$("#"+n.id+"").addClass("errorClass"))}function childValidAge(){var n=!0;return $("#pRoom1").is(":visible")===!0?($('#pRoom1 span[id^="pChildAges"]').find("select").each(function(){$(this).is(":visible")===!0&&$(this).val()==="-1"&&($(this).addClass("errorClass"),n=!1)}),$("#pRoom2").is(":visible")===!0&&($(' #pRoom2 span[id^="pChildAges"]').find("select").each(function(){$(this).is(":visible")===!0&&$(this).val()==="-1"&&($(this).addClass("errorClass"),n=!1)}),$("#pRoom3").is(":visible")===!0&&$('#pRoom3 span[id^="pChildAges"]').find("select").each(function(){$(this).is(":visible")===!0&&$(this).val()==="-1"&&($(this).addClass("errorClass"),n=!1)})),n):n}function submitPrice(){var n=countPax(1);if(childValidAge()){if(n>6)return alert("Max guest allowed (adults + children) are 6 !"),$(".btnContinue").click(function(){submitPrice()}),!1;if(n===!1)return $(".btnContinue").click(function(){submitPrice()}),!1;submitCompList()}else return alert("Child age is empty"),$(".btnContinue").click(function(){submitPrice()}),!1}function submitCompList(){var r=!1,u,t,f,i,n;if($("#frmTransp div[id^='cityTo']").each(function(){var t;if(!isNaN(parseInt($(this).attr("id").replace("cityTo","")))){var i=$(this).find("div input[id^='xIDCity']").val(),n=findNextCity(i),u=$(this).find("div input[id^='xNACity']").val();if(n=="")return $(this).find("div input[id^='xNACity']").val(n),startAgain(this),t=$(this).attr("id"),varIdCity="qNACity"+getNumericPart(t),$("#formBYO input[id='"+varIdCity+"']").val("Select city or airport"),$("#formBYO input[id='"+varIdCity.replace("NA","ID")+"']").val(-1),r=!0,!1;n!=u&&$(this).find("div input[id^='xNACity']").val(n)}}),r==!0){$(".btnContinue").click(function(){submitPrice()});byoValidation();return}t=$("#frmTransp").serialize();t=t.substr(0,t.indexOf("&__RequestVerificationToken"));f=QueryStringToJSON(t);i={};$("#frmTransp").serializeArray().forEach(function(n){i[n.name]=n.value});n={};n.url=SiteName+"/Api/Packages/webservComponentList";n.type="POST";n.contentType="application/json";n.data=JSON.stringify(i);n.dataType="json";n.success=function(n){u=n;submitToBP(f,u)};n.error=function(n){console.log(n)};$.ajax(n)}function submitToBP(n,t){var e,f;$(".dvMMask").append('<div style="background:white; width:95%; margin:0 auto"><img src="https://pictures.tripmasters.com/siteassets/m/SearchingAH.gif" style="width:100%; height:100%"/><\/div>').show();var r=t.split("@|@"),o=$("#formToBooking"),u="";if(r[1]==="1")for(o.find("input").each(function(){/SystemID/.test(this.id)?this.value=r[2]:"";/PackageComponentList/.test(this.id)?this.value=r[0]:"";/ByStayNite/.test(this.id)?this.value=r[3]:"";/GetNextDay/.test(this.id)?this.value=r[4]:"";/AirVendorAPI/.test(this.id)?this.value=r[5]:"";/AirP2PVendorAPI/.test(this.id)?this.value=r[6]:"";/CarVendorAPI/.test(this.id)?this.value=r[7]:"";/SSVendorAPI/.test(this.id)?this.value=r[8]:"";/TransferVendorAPI/.test(this.id)?this.value=r[9]:"";/TICVendorAPI/.test(this.id)?this.value=r[10]:"";bookingurl=r[12];/GIVendorAPI/.test(this.id)?this.value=r[13]:"";/addFlight/.test(this.id)?this.value=n.xaddFlight:"";/Cabin/.test(this.id)?this.value=n.xCabin:"";/iDepCity|iRetCity/.test(this.id)?this.value=n.xidLeavingFrom:"";/iRetCity/.test(this.id)?this.value=n.xidReturningTo==undefined?n.xidLeavingFrom:n.xidReturningTo:"";/StayCityS/.test(this.id)?this.value=n.xNOCityS?n.xIDCityS:n.xIDCity1:"";/StayCityS_Name/.test(this.id)?this.value=n.xNOCityS?decodeURIComponent(n.xNACityS.replace(/\+/g," ")):decodeURIComponent(n.xNACity1.replace(/\+/g," ")):"";/StayCityE/.test(this.id)?this.value=n.xNoCityE?n.xIDcityE:n["xIDCity"+r[11]]:"";/StayCityE_Name/.test(this.id)?this.value=n.xNoCityE?decodeURIComponent(n.xNAcityE.replace(/\+/g," ")):decodeURIComponent(n["xNACity"+r[11]].replace(/\+/g," ")):"";/Rooms/.test(this.id)?(this.value=n.xRooms,$("#xRooms").val("1")):"";/iRoom/.test(this.id)?(this.value=n.xiRoom,$("#xiRooms").val("1")):"";/iRoomsAndPax/.test(this.id)?(this.value=decodeURI(n.xiRoomsAndPax),$("#xcabinRoomPax").val("1 Room, 2 Travelers, Economy"),$("#xiRoomsAndPax").val("1|2")):"";/iAdults/.test(this.id)?/Room/.test(this.id)?"":(this.value=n.xiAdults,$("#xiAdults").val("2")):"";/iChildren/.test(this.id)?/Room/.test(this.id)?"":(this.value=n.xiChildren,$("#xiChildren").val("")):"";/iChild1/.test(this.id)?/Room/.test(this.id)?"":n.xiChild1?(this.value=n.xiChild1,$("#xiChild1").val("")):"":"";/iChild2/.test(this.id)?/Room/.test(this.id)?"":n.xiChild2?(this.value=n.xiChild2,$("#xiChild2").val("")):"":"";/iChild3/.test(this.id)?/Room/.test(this.id)?"":n.xiChild3?(this.value=n.xiChild3,$("#xiChild3").val("")):"":"";/iChild4/.test(this.id)?/Room/.test(this.id)?"":n.xiChild4?(this.value=n.xiChild4,$("#xiChild4").val("")):"":"";/Room2_iAdults/.test(this.id)?n.xRoom2_iAdults?(this.value=n.xRoom2_iAdults,$("#xRoom2_iAdults").val("")):this.value="":"";/Room2_iChildren/.test(this.id)?n.xRoom2_iChildren?(this.value=n.xRoom2_iChildren,$("#xRoom2_iChildren").val("")):this.value="":"";/Room2_iChild1/.test(this.id)?n.xRoom2_iChild1?(this.value=n.xRoom2_iChild1,$("#xRoom2_iChild1").val("")):this.value="":"";/Room2_iChild2/.test(this.id)?n.xRoom2_iChild2?(this.value=n.xRoom2_iChild2,$("#xRoom2_iChild2").val("")):this.value="":"";/Room2_iChild3/.test(this.id)?n.xRoom2_iChild3?(this.value=n.xRoom2_iChild3,$("#xRoom2_iChild3").val("")):this.value="":"";/Room2_iChild4/.test(this.id)?n.xRoom2_iChild4?(this.value=n.xRoom2_iChild4,$("#xRoom2_iChild4").val("")):this.value="":"";/Room3_iAdults/.test(this.id)?n.xRoom3_iAdults?(this.value=n.xRoom3_iAdults,$("#xRoom3_iAdults").val("")):this.value="":"";/Room3_iChildren/.test(this.id)?n.xRoom3_iChildren?(this.value=n.xRoom3_iChildren,$("#xRoom3_iChildren").val("")):this.value="":"";/Room3_iChild1/.test(this.id)?n.xRoom3_iChild1?(this.value=n.xRoom3_iChild1,$("#xRoom3_iChild1").val("")):this.value="":"";/Room3_iChild2/.test(this.id)?n.xRoom3_iChild2?(this.value=n.xRoom3_iChild2,$("#xRoom3_iChild2").val("")):this.value="":"";/Room3_iChild3/.test(this.id)?n.xRoom3_iChild3?(this.value=n.xRoom3_iChild3,$("#xRoom3_iChild3").val("")):this.value="":"";/Room3_iChild4/.test(this.id)?n.xRoom3_iChild4?(this.value=n.xRoom3_iChild4,$("#xRoom3_iChild4").val("")):this.value="":""}),i=1;i<=12;i++)n["xIDCity"+i]?(f=decodeURIComponent(n["xNACity"+i]),f=decodeURIComponent(f.replace(/\+/g," ")),e=0,u=u+'<input type="hidden" id="StayCity'+i+'" name="StayCity'+i+'" value="'+n["xIDCity"+i]+'"/>',u=u+'<input type="hidden" name="StayCity'+i+'_Name" id="StayCity'+i+'_Name" value="'+f+'" />',i===1?u=u+'<input type="hidden" name="InDate'+i+'" id="InDate'+i+'" value="'+decodeURIComponent(n.xtxtBYArriving)+'" />':"",u=u+'<input type="hidden" name="APICity'+i+'" id="APICity'+i+'" value="'+decodeURIComponent(n["xAPICity"+i])+'"/>',u=u+'<input type="hidden" name="StayNite'+i+'" id="StayNite'+i+'" value="'+n["xSTCity"+i]+'"/>',n["xOVNCity"+i]?e=n["xOVNCity"+i]:"",u=u+'<input type="hidden" name="OverNiteT'+i+'" id="OverNiteT'+i+'" value="'+e+'"/>',$("#formToBooking").append(u),u=""):i=12,i===12?toBPGo():"";else alert("error")}function toBPGo(){var n=$("#formToBooking").serialize();document.formToBooking.action=bookingurl;document.formToBooking.submit();resetForm()}function resetForm(){$("#xcabinRoomPax").val("1 Room, 2 Travelers, Economy");$("#xiRoomsAndPax").val("1|2");selectRoomPax("1|2");var n=document.getElementById("formToBooking");n.reset();$(n).find("input").each(function(){if(this.id!=="GeneralLoc"&&this.id!=="bFirst"&&this.id!=="sortFlag"&&this.id!=="MinStay"&&this.id!=="addCar"&&this.id!=="iOutTime"&&this.id!=="iInTime"&&this.id!=="addTransfer_IC"&&this.id!==""&&this.id!="PkgInstance")for($("#"+this.id).val(""),i=1;i<=12;i++)$(n).find("#StayCity"+i).remove(),$(n).find("#StayCity"+i+"_Name").remove(),$(n).find("#InDate"+i).remove(),$(n).find("#APICity"+i).remove(),$(n).find("#StayNite"+i).remove(),$(n).find("#OverNiteT"+i).remove()});$("#myModal, .modal-content").slideUp();$(".dvTransportation").hide().removeAttr("style");$(".dvMask").hide().removeAttr("height");$("div.dvtranspCityList").remove();$("#dvTranspError").hide()}function QueryStringToJSON(n){var i=n.split("&"),t={};return i.forEach(function(n){n=n.split("=");var i=n[0],r=n[1];i.length&&(t[i]!==undefined?(t[i].push||(t[i]=[t[i]]),t[i].push(r||"")):t[i]=r||"")}),t}function popItinInfo(n,t,i,r,u){$("."+u+"Info").each(function(){var t=$(this).attr("id"),i=t.match(isNumber);i==n?$("#"+t+"").is(":visible")==!1?$("#"+t+"").slideDown():$("#"+t+"").slideUp():""});i===1?relPackCall(n,t):""}var depCities=[],arrivalCities=[],myDate=new Date,backCookie,visitID,getNumericPart;$(function(){var i,n,t;$('div[id^="info"]').click(function(){i=this.id.match(/[\d\.]+/g);t=this.getAttribute("data-id").split("|");$('div[id^="divInfo"]').each(function(){n=this.id.match(/[\d\.]+/g);Number(i)!=Number(n)?$("#divInfo"+n+"").is(":visible")?($("#divInfo"+n+", #arrowInfo"+n+"").slideUp(),$("#info"+n+"").toggleClass("opened",function(){otherMoreDetails(t[0],t[1],1)})):"":$("#divInfo"+i+"").is(":visible")?($("#divInfo"+i+", #arrowInfo"+i+"").slideUp(),$("#info"+i+"").toggleClass("opened",function(){otherMoreDetails(t[0],t[1],1)})):($("#divInfo"+n+", #arrowInfo"+n+"").slideDown(),$("#info"+n+"").toggleClass("opened",function(){otherMoreDetails(t[0],t[1],1)}))})})});$(document).ready(function(){if($(".template-RecentlyViewed").hide(),$(".moreViewed").hide(),$(".moreButton").click(function(){$(".dvEachHighHide").is(":visible")===!1?($(this).html("Close More Highlights & Attractions <span><\/span>"),$(".dvEachHighHide").slideDown(),$(".moreButton span").css("transform","rotate(270deg)")):($(this).html("More Highlights & Attractions <span><\/span>"),$(".dvEachHighHide").slideUp(),$(".moreButton span").css("transform","rotate(90deg)"))}),$(".moreHightButt").click(function(){$(".dvEachHighHide").is(":visible")===!1?($(this).html("Close More Highlights & Attractions"),$(".dvEachHighHide").slideDown()):($(this).html("More Highlights & Attractions"),$(".dvEachHighHide").slideUp())}),Cookies.get("ut2")!=undefined){var n=Cookies.get("ut2").split("&"),t=n[0].split("=");visitID=t[1]}else _ut2Functions.push(function(){utValues=_ut2;jQuery.each(utValues,function(n,t){n=="_utvId"&&(visitID=t)})});$(".dvEachPopItinInfo").hide();$(".dvEachSpotDstInfo").hide();$(".eachSec2Info").hide();$(".dvEachIdeasMore").click(function(){var n=this.getAttribute("data-id").split("|");otherMoreDetails(n[0],n[1],1)});$(".dvIdeasClose span").click(function(){var n=this.getAttribute("data-id").split("|");otherMoreDetails(n[0],n[1],0)});$(".dvEachPopItin, .eachSec2, .dvEachSpotDst").click(function(){var n=this.getAttribute("data-id").split("|"),t=this.getAttribute("class");popItinInfo(n[0],n[1],1,$(this).position(),t)});$(".dvPopItinClose span, eachSec2 span, .dvEachSpotDst span").click(function(){var n=this.id.match(isNumber);n;0});$(".moreViewed, .buildButton, .customBtn, .btnRevMore").click(function(){winlocation(this.getAttribute("data-go-to"))});$('select[id*="iChild"]').click(function(){/iChild/g.test(this.id)===!0?$("#"+this.id+"").select().removeClass("errorClass"):""});doAjaxOnReady();$(".btnAddCty").click(function(){qaddCity(this)});$(".btnNoMore").click(function(){byoValidation()});$(".dvIntlFly span.wair").click(function(){withAir(this)});$(".btnContinue").click(function(){submitPrice()})});$.fn.serializeObject=function(){var n={},t=this.serializeArray();return $.each(t,function(){n[this.name]?(n[this.name].push||(n[this.name]=[n[this.name]]),n[this.name].push(this.value.trim()||"")):n[this.name]=this.value.trim()||""}),n};var thumPic="",thumMap="",isNumber=/[0-9]+/g;$(document).ready(function(){maskH=$(document).height();maskW=$(window).width();$(".moreButton").click(function(){$(".dvEacHighhHide").is(":visible")===!1?($(this).html("Close More Highlights & Attractions "),$(".dvEacHighhHide").slideDown()):($(this).html("More Highlights & Attractions"),$(".dvEacHighhHide").slideUp())});$(".dvSuggestTitle a, .dvEachSuggest2ndCol").click(function(){var n=this.id,t=$("#divInfo"+n+"");return t.is(":visible")==!1?(t.slideDown(),$('div.dvEachSuggest2ndCol[id="'+n+'"]').css("transform","rotate(270deg)"),otherMoreDetails(n,1)):(t.slideUp(),$('div.dvEachSuggest2ndCol[id="'+n+'"]').css("transform","rotate(90deg)")),!1})});getNumericPart=function(n){return n.replace(/[^\d]+/,"")};