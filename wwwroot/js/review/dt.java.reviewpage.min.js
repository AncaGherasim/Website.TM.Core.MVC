function sortReview(n){var i,t;objRev=[];objData=n;i=0;$("#reviewTotal").val(objData.length);t="";jQuery.each(objData,function(){i==0?t=this.PCCID:i%10==0?(objRev.push(t),t=this.PCCID):t=t+","+this.PCCID;i++});i==objData.length&&(objRev.push(t),callReviewData(numPg),createPagination())}function filterReview(n){objFilt=objAjax;objFilt=$.grep(objFilt,function(t){return t.Score==n});setTimeout(function(){sortReview(objFilt)},300)}function callReviewData(){var n="",i=Number(numPg-1),t={};t.url=SiteName+"/Api/getDataReviewPage";t.type="POST";t.contentType="application/json";t.data=JSON.stringify(objRev[i]);t.dataType="json";t.success=function(t){rvData=t;var u,i,r;jQuery.each(rvData,function(){var t,o,a,h,v,y,p;n=n+'<div class="dveachReview">';n=n+'<div class="dvEachRvwLeft">';switch(!0){case this.STR_UserId===243||this.dept===1615:u="Europe";i="/europe/";break;case this.STR_UserId===182||this.dept===1617:u="Latin America";i="/latin/";break;case this.STR_UserId===595||this.dept===1425:u="Asia & South Pacific";i="/asia/"}if(r=this.PCC_PDLID!=0?1:0,r===1?this.PDL_NoWeb===!0?r=0:"":"",r==1?(t=0,n=n+'<span class="spEaReLeLine"><a href="'+i+this.CountryNA.toLowerCase()+"/"+this.PDL_Title.replace(/\s/g,"_").toLowerCase()+"/feedback-"+this.PCC_PDLID+'">'+this.PDL_Title+"<\/a><\/span>",n=n+'<span class="spEaReLeLine"><font class="fntLightText">('+this.NoOfFeed+" reviews)<\/font><\/span>",this.STP_Save!=9999&&this.STP_Save!=0&&(n=n+'<span class="spEaReLeLine"><font class="darkText" style="padding-bottom:2px!important;">Price for this package starting at <\/font><font class="orangeText"><b>'+formatCurrency(this.STP_Save)+"*<\/b><\/font><\/span>"),this.RelatePlaces!=null&&(o=this.RelatePlaces.trim().slice(0,-1).split("@"),n=n+'<span class="spEaReLeLine"><b>See Reviews for:<\/b> <br/>',t=0,o.forEach(function(r){var u=r.split("|");n=n+'<a class="alightcolor" href="'+i+u[0].trim().replace(/\s/g,"_").toLowerCase()+'/trips_taken_by_travelers">'+u[0].trim()+"<\/a>";t==o.length-1?"":n=n+' <font style="color:#999"> - <\/font> ';t++}),n=n+"<\/span>"),n=n+"<\/div>"):n=n+'<span class="spEaReLeLine"><a href="'+i+'">Explore '+u+"<\/a><\/span> <\/div>",n=n+'<div class="dvEachRvwRight">',this.OverallScore!=-999&&this.OverallScore!=0&&(n=n+'<div style="padding:0px 0 10px 0px;position:relative;"><img alt="'+this.OverallScore+'" src="https://pictures.tripmasters.com/siteassets/d/Stars_'+this.OverallScore+'_Stars.gif"/><span class="darkText" style="font-weight:normal;padding:0 0 0 8px;position:absolute;margin-top:0px;">('+this.OverallScore+" out of 5)<\/span><\/div>"),this.TCF_FeedbackReceivedTime!=null){var s=new Date(this.TCF_FeedbackReceivedTime),f=s.getDate(),e=s.getMonth()+1,l=s.getFullYear();l>2e3&&(f<10&&(f="0"+f),e<10&&(e="0"+e),a=e+"/"+f+"/"+l,n=n+'<span class="spEaReLeTitle">Date:<\/span><span class="spEaReLeDesc">'+a+'<\/span> <br style="clear:both"/>')}if(n=n+"<p>"+FormatCustomerComment(this.PCC_Comment)+" <\/p>",r==1){if(h=0,n=n+'<div class="dvLinearTopBgRev dvitinInclude"> <span class="spEaReRiLeft"> <b>Itinerary Details:<\/b><br/>',n=n+"<font>"+this.PCC_Itinerary.replace(/\n/g,"<br />")+"<\/font>",n=n+"<\/span>",this.RelatePlaces!=null){v=this.RelatePlaces.trim().slice(0,-1).split("@");n=n+'<span class="spEaReRiRight"> <b>Places visited in this trip:<\/b>';n=n+'<p class="pPlcVisit">';v.forEach(function(t){var r=t.split("|");(r[2]==25||r[2]==1)&&(h==0?"":n=n+' <font style="color:#999"> - <\/font> ',n=n+'<a class="alightcolor" href="'+i+r[0].trim().replace(/\s/g,"_").toLowerCase()+'/vacations">'+r[0].trim()+"<\/a>",h++)});n=n+"<\/p>";n=n+"<br/>";n=n+"<b>More choices, combine cities found in this Itinerary:<\/b><br/>";n=n+'<form name="frm'+this.PCCID+'" id="frm'+this.PCCID+'" method="post"><ul class="dvColumn">';var c=this.PCCID,w=this.RelatePlaces.trim().slice(0,-1).split("@");w.forEach(function(t){var i=t.split("|");(i[2]==25||i[2]==1)&&(n=n+'<li><span class="spCheckBox">',n=n+'<a style="cursor:pointer;" class="falsecheckdop" id="falsedop'+c+i[1].trim()+'" >'+i[0]+"<\/a>",n=n+"<\/span>",n=n+'<input type="checkbox" name="dop'+c+i[1].trim()+'" id="dop'+c+i[1].trim()+'" style="display:none" value="'+t.trim()+'"/><\/li>')});n=n+'<\/ul><input type="hidden" name="allID" id="allID" value="" />';n=n+'<input type="hidden" name="allNA" id="allNA" value="" />';n=n+"<\/form>";y="'frm"+this.PCCID+"'";p="'"+i+"'";n=n+'<p class="pSimilar"><a class="alightcolor" href="/" onclick="findSimilar('+y+","+p+'); return false;">>> Find similar itineraries<\/a><\/p>';n=n+'<\/span> <br style="clear:both"/>'}else n=n+'<span class="spEaReRiRight"><\/span><br style="clear:both"/>';n=n+"<\/div>"}n=n+"<\/div>";n=n+'<br style="clear:both"/>';r==1&&(n=n+'<div class="spBgLinearBlue" style="padding-right:15px; width:98%;display: inline-flex">',n=n+'<p class="bookItButton"><a class="button" href="'+i+this.CountryNA.toLowerCase()+"/"+this.PDL_Title.replace(/\s/g,"_").toLowerCase()+"/package-"+this.PCC_PDLID+'">Customize a trip like this one<\/a><\/p>',n=n+"<\/div>");n=n+"<\/div>";n=n+'<div class="dvhr">&nbsp;<\/div>'});$("#dvReviews").html(n);checkBoxes()};t.error=function(n){alert(n.responseText);$("#dvReviews").html(n.responseTex)};$.ajax(t)}function findSimilar(n,t){var r,s,h,u,f,e,o;for($("#"+n+" #allID").val()!=""&&$("#"+n+" #allID").val(""),$("#"+n+" #allNA").val()!=""&&$("#"+n+" #allNA").val(""),r=$("#"+n).serialize(),r.indexOf("&__")>0&&(r=r.substring(0,r.indexOf("&__"))),o=0,r=r.replace(/\+/g," "),r=r.replace(/\%7C/g,"|"),s=r.split("&"),i=0;i<s.length;i++)h=s[i].split("="),h[1]!=""&&(o=o+1,u=h[1].split("|"),o>1?(f=f+","+u[1],e=e+"_-_"+u[0].replace(/\s/g,"-")):(f=u[1],e=u[0].replace(/\s/g,"-")));if(f==undefined){alert("Please check at least one box. Thanks!");return}$("#"+n+" #allID").val(f);$("#"+n+" #allNA").val(e);window.location=t+e.toLowerCase()+"/find-packages"}function checkBoxes(){$("input:checkbox").each(function(){this.checked?$("#falsedop"+this.id.match(isNumber)+"").addClass("falsecheckeddop"):$("#falsedop"+this.id.match(isNumber)+"").removeClass("falsecheckeddop")});$(".falsecheckdop").click(function(){return replID=this.id.match(isNumber),$(this).hasClass("falsecheckeddop")?($(this).removeClass("falsecheckeddop"),$("#dop"+replID+"").removeAttr("checked")):($(this).addClass("falsecheckeddop"),$("#dop"+replID+"").attr("checked",!0)),!1})}function FormatCustomerComment(n){var i="",r="",u,t;return(n=n.trim(),n.length==0)?"":n.indexOf("---")!=-1?n.replace(/\n/g,"<br />"):(u=new RegExp("[!?.]"),u.test(n)&&(t=n.match(u),t!=null?(i=n.substring(0,t.index+1),r=n.substring(t.index+1)):(i=n,r="")),"<b>"+i.replace(/\n/g,"<br />")+"<\/b>"+r.replace(/\n/g,"<br />"))}function createPagination(){$(".dvPaginas").pagination("destroy");PGtotal=objRev.length;$(".dvPaginas").pagination({pages:PGtotal,itemsOnPage:10,cssStyle:"light-theme",onPageClick:function(n){return scroll(0,0),clickPG=1,$("#dvReviews").animate({opacity:".0"},100),$("#dvReviews").html('<div id="imgWait" style="padding:100px; text-align:center"><img id="imgWait" src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif"/><\/div>'),$("#dvReviews").animate({opacity:"1"},0),numPg=n,callReviewData(n),!1}})}function formatCurrency(n){var i,t;for(n=n.toString().replace(/\$|\,/g,""),isNaN(n)&&(n="0"),sign=n==(n=Math.abs(n)),n=Math.floor(n*100+.50000000001),cents=n%100,n=Math.floor(n/100).toString(),cents<10&&(cents="0"+cents),i=Math.floor(n.length),i=Number(i)-1,t=0;t<Math.floor(Number(i+t)/3);t++)n=n.substring(0,Number(n.length)-(4*t+3))+","+n.substring(Number(n.length)-(4*t+3));return(sign?"":"-")+"$"+n}var objRev=[],objAjax,objData,objFilt,PGtotal,isNumber=/[0-9]+/g,numPg=1,sortPg=1,num;$(document).ready(function(){var n={};n.url=SiteName+"/Api/getDataReviewFirst";n.type="POST";n.contentType="application/json";n.dataType="json";n.success=function(n){objAjax=n;sortReview(objAjax)};n.error=function(n){alert(n.responseText);$("#dvReviews").html(n.responseTex)};$.ajax(n);$(".rad").click(function(){sortPg=this.value;numPg=1;objRev=[];sortReview(objAjax)});$(".dvfilter").click(function(){$("#dvReviews").html('<div id="imgWait" style="padding:100px; text-align:center"><img id="imgWait" src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif"/><\/div>');numPg=1;filterReview(this.id)})});