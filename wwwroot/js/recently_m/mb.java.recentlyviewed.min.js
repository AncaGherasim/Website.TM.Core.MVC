function RecentlyViewedFromCookie(){var n=Cookies.get("ut2").split("&"),t=n[0].split("=");visitID=t[1];utVisitorID=visitID;$.ajax({url:"/Api/RecentlyViewed",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({Name:utVisitorID}),type:"POST",success:function(n){$("#loading").remove();let t=0;n?t=n.length:"";var i=Math.ceil(t/10);if($("#novisited").text(t),t>0){if(buildRecentlyViewed(n),t>perpage){const n=t-perpage;n<perpage&&$(".dvViewDisplayMore button").html(`${n} More recently Viewed ${n===1?"Package":"Packages"}`)}}else $(".dvRoundContainer").append("<p class='col-12'>You don't have any recent views<\/p>")},error:function(n){$("#loading").remove();console.log(n)}})}function ShowHideMore(n,t){for(i=1;i<=t;i++){var r=i.toString();i<=n?($(".dvpage"+r).show(),i<n&&$("#displayMore"+r).hide()):$(".dvpage"+r).hide()}}function buildRecentlyViewed(n){var t="",i,r,u;t=t+'<div class="dvViewList">';i=Math.ceil(n.length/perpage);for(let f=1;f<=i;f++)t=t+'<div class="dvpage'+f+'" style="display:'+(f>1?"none":"block")+'">',r=0,jQuery.each(n,function(){r++;r>(f-1)*perpage&&r<=f*perpage&&(liItems="",this.PDL_Content.split("\r\n").map(function(n){liItems=liItems+"<li>"+n+"<\/li>"}),t=t+`<div class="dvEachView">
					       <div class="dvViewImage">
						     <img src="https://pictures.tripmasters.com${this.IMG_Path_URL.toLowerCase()}"/>
                           </div>
						   <div class="dvViewInfo">
						     <div>
							   <a href="${getSiteURL(this.UTS_Site)}/${this.STR_PlaceTitle.replace(/ /g,"_")}/${this.PDL_Title.replace(/ /g,"_")}/package-${this.PDLID}">${this.PDL_Title}</a>
                             </div>
						     <div class="dvViewIncludes">
							   <span>Itinerary Includes:</span>
							   <ul>`+liItems+`</ul>
							 </div>
						 </div> 
						 <div class="dvViewBtn">
						   <div class="dvViewed">Viewed ${getVisitTime(this.UTS_Date)}</div>
                           ${this.feedbacks>0?`<a class="lnkFeedTravel" href="${getSiteURL(this.UTS_Site)}/${this.STR_PlaceTitle.replace(/ /g,"_")}/${this.PDL_Title.replace(/ /g,"_")}/feedback-${this.PDLID}">${this.feedbacks} Travelers reviewed this package</a>`:""}  
						   <a class="dvViewIt" href="${getSiteURL(this.UTS_Site)}/${this.STR_PlaceTitle.replace(/ /g,"_")}/${this.PDL_Title.replace(/ /g,"_")}/package-${this.PDLID}"> Customize It</a>
                         </div>
                       </div>`)}),f<i&&(u=parseInt(f,10)+1,t=t+`<div class="dvViewDisplayMore" id="displayMore${f}">
					                     <button onclick="ShowHideMore(${u}, ${i})"> 10 More recently Viewed Packages</button>
					                   </div>`),t=t+"<\/div>";t=t+"<\/div>";$("div .dvRoundContainer").append(t)}function getSiteURL(n){let t;switch(n){case"TMED":t="/europe";break;case"TMASIA":t="/asia";break;case"TMLD":t="/latin";break;case"TMLUX":t="/luxury"}return t}function getVisitTime(n){const t=Date.parse(n),i=new Date(t),r=new Date;return timeBetween(i,r)}var utVisitorID=-1,visitID;const perpage=10;let nextPage=1;$(document).ready(function(){if($(".dvRoundContainer").append('<div class="col-12" id="loading" style="text-align:center; padding:50px;"><img src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif"/><br/>loading ...<br/><\/div>'),Cookies.get("ut2")!=undefined)RecentlyViewedFromCookie();else{let t=0;var n=setInterval(function(){t++;console.log("Check cookie "+t);(Cookies.get("ut2")!=undefined||t>=2)&&(clearInterval(n),RecentlyViewedFromCookie())},1e3)}});