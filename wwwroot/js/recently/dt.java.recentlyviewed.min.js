function RecentlyViewedFromCookie(){var n=Cookies.get("ut2").split("&"),t=n[0].split("=");visitID=t[1];utVisitorID=visitID;$.ajax({url:"/Api/RecentlyViewed",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({Name:utVisitorID}),type:"POST",success:function(n){$("#loading").remove();let t=0;if(n?t=n.length:"",$("#novisited").text(t),t>0){if(buildRecentlyViewed(n),t>perpage){const n=t-perpage;n<perpage&&$(".dvViewDisplayMore button").html(`${n} More recently Viewed ${n===1?"Package":"Packages"}`)}}else $(".dvRoundContainer").append("<p style='text-align:center;font-size:15px;color:#666;'>You don't have any recent views<\/p>")},error:function(n){$("#loading").remove();console.log(n)}})}function buildRecentlyViewed(n){var t="",r=Math.ceil(n.length/perpage),i,u;for(let f=1;f<=r;f++)t=t+'<div id="pagDV'+f+'" class="dvEachVis dvpage'+f+'" style="display:'+(f>1?"none":"block")+'">',i=0,n.map(function({UTS_Site:h,STR_PlaceTitle:o,PDL_Title:e,PDLID:r,IMG_Path_URL:n,feedbacks:c,PDL_Content:u,UTS_Date:s}){i++;i>(f-1)*perpage&&i<=f*perpage&&(divPackage=`<div class="dvImage">
					 <a href="${getSiteURL(h)}/${getReplaceStr(o.toLowerCase())}/${getReplaceStr(e.toLowerCase())}/package-${r}">
					   <img src="https://pictures.tripmasters.com${n.toLowerCase()}"/>
					 </a>
					</div>
					<div class="dvInfo">
					  <div class="dvInfoTitle" id="pos${r}">
						<a href="${getSiteURL(h)}/${getReplaceStr(o.toLowerCase())}/${getReplaceStr(e.toLowerCase())}/package-${r}">
						  ${e}
						</a>
					  </div>
					  <div class="dvDetails">
						<div style="font-weight:bold; padding:3px 0px 0px 0px; color:#333; font-size:12px; text-align:left;">
						  Itinerary includes:
						</div>
						<div>
						  <ul style="padding:3px 12px; margin:0px; font-size:12px; color:#666; text-align:left;">
							${u.split("\r\n").map(n=>`<li>${n}</li>`).join("")}
						  </ul>
						</div>
					  </div>
					</div>
					<div class="dvButton">
					  <div class="dvViewed">Viewed ${getVisitTime(s)}</div>
					  ${c>0?`<div class="dvViewed">
										   <a href="${getSiteURL(h)}/${getReplaceStr(o.toLowerCase())}/${getReplaceStr(e.toLowerCase())}/feedback-${r}">
											 ${c} Travelers reviewed this package
										   </a>
										 </div>`:""}
					  <div style="padding:10px 0; margin-left:60px">
						<a class="customize" href="${getSiteURL(h)}/${getReplaceStr(o.toLowerCase())}/${getReplaceStr(e.toLowerCase())}/package-${r}">
						  Customize It
						</a>
					  </div>
					</div>
					<div style="clear:both;"></div>
					<hr class="gradLineTop"/>`,t=t+divPackage)}),f<r&&(u=parseInt(f,10)+1,t=t+`<div class="dvViewDisplayMore" id="displayMore${f}">
					                     <button onclick="ShowHideMore(${u}, ${r})"> 10 More recently Viewed Packages</button>
					                   </div>`),t=t+"<\/div>";t=t+"<\/div>";$("div .dvItemsContainer").append(t)}function ShowHideMore(n,t){for(i=1;i<=t;i++){var r=i.toString();i<=n?($(".dvpage"+r).show(),i<n&&$("#displayMore"+r).hide()):$(".dvpage"+r).hide()}}function getSiteURL(n){let t;switch(n){case"TMED":t="/europe";break;case"TMASIA":t="/asia";break;case"TMLD":t="/latin";break;case"TMLUX":t="/luxury"}return t}function getVisitTime(n){const t=Date.parse(n),i=new Date(t),r=new Date;return timeBetween(i,r)}function getReplaceStr(n){return n.replace(/ /g,"_")}var utVisitorID=-1,visitID;const perpage=10;let nextPage=1;$(document).ready(function(){if($(".dvItemsContainer").append('<div id="loading" style="text-align:center; padding:50px;"><img src="https://pictures.tripmasters.com/siteassets/d/ajax-loader.gif"/><br/>loading ...<br/><\/div>'),Cookies.get("ut2")!=undefined)RecentlyViewedFromCookie();else{let t=0;var n=setInterval(function(){t++;console.log("Check cookie "+t);(Cookies.get("ut2")!=undefined||t>=2)&&(clearInterval(n),RecentlyViewedFromCookie())},1e3)}});